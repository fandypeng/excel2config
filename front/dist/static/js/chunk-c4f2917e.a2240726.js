(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c4f2917e"],{"23ba":function(e,t,r){"use strict";r.d(t,"h",(function(){return n})),r.d(t,"g",(function(){return s})),r.d(t,"j",(function(){return i})),r.d(t,"i",(function(){return a})),r.d(t,"f",(function(){return l})),r.d(t,"a",(function(){return c})),r.d(t,"e",(function(){return d})),r.d(t,"k",(function(){return u})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return f}));var o=r("b775");function n(e){return Object(o["a"])({url:"/group/list",method:"get",params:{gid:e}})}function s(e){return Object(o["a"])({url:"/group/add",method:"post",data:e})}function i(e){return Object(o["a"])({url:"/group/update",method:"post",data:e})}function a(e){return console.log(e),Object(o["a"])({url:"/group/test_connection",method:"post",data:e})}function l(e){return console.log(e),Object(o["a"])({url:"/group/get_config_from_db",method:"post",data:e})}function c(e){return console.log(e),Object(o["a"])({url:"/group/export_config_to_db",method:"post",data:e})}function d(){return Object(o["a"])({url:"/group/gen_app_key_secret",method:"get"})}function u(e){return console.log(e),Object(o["a"])({url:"/group/sync_to_prod",method:"post",data:e})}function p(e){return console.log(e),Object(o["a"])({url:"/group/export_record",method:"post",data:e})}function g(e){return console.log(e),Object(o["a"])({url:"/group/export_record_content",method:"post",data:e})}function f(e){return console.log(e),Object(o["a"])({url:"/group/export_rollback",method:"post",data:e})}},5643:function(e,t,r){e.exports=r.p+"static/img/tanchishe-icon.814d2184.png"},"5c39":function(e,t,r){},"6ed3":function(e,t,r){"use strict";r("5c39")},"90fe":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-tabs",{attrs:{type:"border-card"}},[r("el-tab-pane",{attrs:{label:"配置列表"}},[r("div",{staticClass:"operate-box"},[r("el-button",{attrs:{type:e.groupInfo.IsDev?"primary":"danger"},on:{click:e.handleSwitchEnv}},[1==e.groupInfo.IsDev?r("span",[e._v("当前处于测试环境，点击切换到正式环境")]):r("span",[e._v("当前处于正式环境，点击切换到测试环境")])]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.groupInfo.IsDev,expression:"groupInfo.IsDev"}],attrs:{type:"primary"},on:{click:e.handleAddExcel}},[e._v("添加表格")])],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.list,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[r("el-table-column",{attrs:{label:"名称",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-link",{attrs:{href:"#/config/excel/"+t.row.name+"/"+t.row.id,type:"primary"}},[e._v(e._s(t.row.name))])]}}])}),r("el-table-column",{attrs:{label:"创建者",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.owner))])]}}])}),r("el-table-column",{attrs:{label:"备注",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.remark)+" ")]}}])}),r("el-table-column",{attrs:{label:"创建时间",width:"210",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFilter")(t.row.createTime))+" ")]}}])}),r("el-table-column",{attrs:{label:"编辑时间",width:"210",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFilter")(t.row.editTime))+" ")]}}])}),r("el-table-column",{attrs:{"class-name":"status-col",label:"发布",width:"300",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"success",size:"small"},on:{click:function(r){return e.handleExport(t)}}},[e._v("发布")]),r("el-button",{attrs:{type:"info",size:"small"},on:{click:function(r){return e.handleExportRecord(t)}}},[e._v("记录")])]}}])}),r("el-table-column",{attrs:{"class-name":"status-col",label:"同步正式环境",width:"300",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.groupInfo.IsDev,expression:"groupInfo.IsDev"}],attrs:{type:"warning",size:"small"},on:{click:function(r){return e.handleExportProd(t)}}},[e._v("同步正式环境")])]}}])}),r("el-table-column",{attrs:{"class-name":"status-col",label:"管理",width:"300",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(r){return e.handleEdit(t)}}},[e._v("编辑")]),r("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(r){return e.handleDelete(t)}}},[e._v("删除")])]}}])})],1),r("el-dialog",{attrs:{visible:e.dialogVisible,title:"edit"===e.dialogType?"编辑Excel信息":"新增Excel"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{attrs:{model:e.excel,"label-width":"80px","label-position":"left"}},[r("el-form-item",{attrs:{label:"名称"}},[r("el-input",{attrs:{placeholder:"名称",disabled:"edit"===e.dialogType},model:{value:e.excel.name,callback:function(t){e.$set(e.excel,"name",t)},expression:"excel.name"}})],1),r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{attrs:{autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"备注"},model:{value:e.excel.remark,callback:function(t){e.$set(e.excel,"remark",t)},expression:"excel.remark"}})],1),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"edit"===e.dialogType,expression:"dialogType==='edit'"}],attrs:{label:"创建者"}},[r("el-input",{attrs:{placeholder:"创建者",disabled:""},model:{value:e.excel.owner,callback:function(t){e.$set(e.excel,"owner",t)},expression:"excel.owner"}})],1)],1),r("div",{staticStyle:{"text-align":"right"}},[r("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.confirmExcel}},[e._v("保存")])],1)],1),r("el-dialog",{attrs:{visible:e.exportDialogVisible,title:"发布表格内容(左边为修改前版本，右边为修改后版本)",width:"80%"},on:{"update:visible":function(t){e.exportDialogVisible=t}}},[r("el-form",{attrs:{model:e.excel,"label-width":"120px","label-position":"left"}},[r("el-form-item",{attrs:{label:"选择表格"}},[r("el-radio-group",{on:{change:function(t){return e.onSelectedSheetChange(1)}},model:{value:e.sleectedSheet,callback:function(t){e.sleectedSheet=t},expression:"sleectedSheet"}},e._l(e.sheetList,(function(t){return r("el-radio",{key:t,attrs:{label:t}},[e._v(e._s(t)+" ")])})),1)],1),r("el-form-item",{attrs:{label:"发布内容"}},[r("el-input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入发布内容"},model:{value:e.exportRemark,callback:function(t){e.exportRemark=t},expression:"exportRemark"}})],1),r("div",[r("code-diff",{attrs:{"old-string":e.oldStr,"new-string":e.newStr,isShowNoChange:!0,renderNothingWhenEmpty:!1,outputFormat:"side-by-side",context:1e3}})],1)],1),r("div",{staticStyle:{"text-align":"right"}},[r("el-button",{attrs:{type:"danger"},on:{click:function(t){e.exportDialogVisible=!1}}},[e._v("取消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.confirmExport}},[e._v("发布")])],1)],1),r("el-dialog",{attrs:{visible:e.exportProdDialogVisible,title:"同步表格内容到正式环境(左边为正式环境版本，右边为测试环境版本)",width:"80%"},on:{"update:visible":function(t){e.exportProdDialogVisible=t}}},[r("el-form",{attrs:{model:e.excel,"label-width":"120px","label-position":"left"}},[r("el-form-item",{attrs:{label:"选择表格"}},[r("el-radio-group",{on:{change:function(t){return e.onSelectedSheetChange(2)}},model:{value:e.sleectedSheet,callback:function(t){e.sleectedSheet=t},expression:"sleectedSheet"}},e._l(e.sheetList,(function(t){return r("el-radio",{key:t,attrs:{label:t}},[e._v(e._s(t)+" ")])})),1)],1),r("div",[r("code-diff",{attrs:{"old-string":e.oldStr,"new-string":e.newStr,isShowNoChange:!0,renderNothingWhenEmpty:!1,outputFormat:"side-by-side",context:1e3}})],1)],1),r("div",{staticStyle:{"text-align":"right"}},[r("el-button",{attrs:{type:"danger"},on:{click:function(t){e.exportProdDialogVisible=!1}}},[e._v("取消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.confirmExportProd}},[e._v("同步")])],1)],1),r("el-dialog",{attrs:{visible:e.exportRecordDialogVisible,title:"发布记录(左边为发布前版本，右边为发布后版本)",width:"80%"},on:{"update:visible":function(t){e.exportRecordDialogVisible=t}}},[r("el-form",{attrs:{model:e.excel,"label-width":"120px","label-position":"left"}},[r("el-form-item",{attrs:{label:"选择表格"}},[r("el-radio-group",{on:{change:function(t){return e.onSelectedSheetChange(3)}},model:{value:e.sleectedSheet,callback:function(t){e.sleectedSheet=t},expression:"sleectedSheet"}},e._l(e.sheetList,(function(t){return r("el-radio",{key:t,attrs:{label:t}},[e._v(e._s(t)+" ")])})),1)],1),r("el-form-item",{attrs:{label:"发布记录"}},[r("el-select",{staticStyle:{width:"500px"},attrs:{filterable:"",placeholder:"选择历史发布记录"},on:{change:function(t){return e.onSelectRecordChange()}},model:{value:e.selectRecordId,callback:function(t){e.selectRecordId=t},expression:"selectRecordId"}},e._l(e.recordList,(function(t){return r("el-option",{key:t.id,attrs:{label:t.remark,value:t.id}},[r("span",{staticStyle:{float:"left","margin-right":"100px"}},[e._v(e._s(t.remark))]),r("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.userName)+" 发布于 "+e._s(t.time))])])})),1),r("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"danger"},on:{click:e.handleRollBack}},[e._v("回退到此版本")])],1),r("div",[r("code-diff",{attrs:{"old-string":e.oldStr,"new-string":e.newStr,isShowNoChange:!0,renderNothingWhenEmpty:!1,outputFormat:"side-by-side",context:1e3}})],1)],1)],1)],1),r("el-tab-pane",{attrs:{label:"项目配置"}},[r("el-form",{ref:"form",attrs:{model:e.groupInfo,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"名称"}},[r("el-input",{attrs:{value:"贪吃蛇大作战"},model:{value:e.groupInfo.name,callback:function(t){e.$set(e.groupInfo,"name",t)},expression:"groupInfo.name"}})],1),r("el-form-item",{attrs:{label:"头像"}},[r("el-col",{attrs:{span:11}},[r("img",{attrs:{id:"group-icon",src:e.groupInfo.avatar,alt:""}}),r("input",{staticClass:"avatar-input",attrs:{type:"file",accept:"image/*",name:"avatar"},on:{change:e.uploadAvatar}})])],1),r("br"),r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.groupInfo.remark,callback:function(t){e.$set(e.groupInfo,"remark",t)},expression:"groupInfo.remark"}})],1),r("el-form-item",{attrs:{label:"数据仓库"}},[r("el-checkbox-group",{staticStyle:{padding:"5px 15px"},model:{value:e.groupInfo.store,callback:function(t){e.$set(e.groupInfo,"store",t)},expression:"groupInfo.store"}},e._l(e.storeOptions,(function(t){return r("el-checkbox",{key:t.key,attrs:{label:t.key}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.inArray(e.groupInfo.store,1),expression:"inArray(groupInfo.store, 1)"}],staticClass:"store-group",attrs:{label:"Redis配置"}},[r("el-form-item",{attrs:{label:"RedisDSN"}},[r("el-input",{attrs:{name:"RedisDSN",type:"text",placeholder:"172.2.1.88:6379"},model:{value:e.groupInfo.RedisDSN,callback:function(t){e.$set(e.groupInfo,"RedisDSN",t)},expression:"groupInfo.RedisDSN"}})],1),r("el-form-item",{attrs:{label:"密码"}},[r("el-input",{attrs:{name:"RedisPassword","auto-complete":"new-password",type:"password",placeholder:"password"},model:{value:e.groupInfo.RedisPassword,callback:function(t){e.$set(e.groupInfo,"RedisPassword",t)},expression:"groupInfo.RedisPassword"}})],1),r("el-form-item",{attrs:{label:"KeyPrefix"}},[r("el-input",{attrs:{type:"text",placeholder:"key prefix 可不填"},model:{value:e.groupInfo.RedisKeyPrefix,callback:function(t){e.$set(e.groupInfo,"RedisKeyPrefix",t)},expression:"groupInfo.RedisKeyPrefix"}})],1),r("el-tag",{staticStyle:{"margin-left":"40px"},attrs:{type:"danger"}},[e._v(" 应用可以通过订阅redis的channel："+e._s(e.groupInfo.RedisKeyPrefix)+"config_refresh 获取配置更新的通知，message为更新的表名 ")]),r("el-form-item",{attrs:{label:" "}},[r("el-button",{attrs:{type:"success"},on:{click:e.testRedisConnection}},[e._v("测试连通性")])],1)],1),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.inArray(e.groupInfo.store,2),expression:"inArray(groupInfo.store, 2)"}],staticClass:"store-group",attrs:{label:"Mysql配置"}},[r("el-form-item",{attrs:{label:"MysqlDSN"}},[r("el-input",{attrs:{type:"text",placeholder:"username:password@tcp(172.2.1.88:3306)/dbname?charset=utf8mb4"},model:{value:e.groupInfo.MysqlDSN,callback:function(t){e.$set(e.groupInfo,"MysqlDSN",t)},expression:"groupInfo.MysqlDSN"}})],1),r("el-form-item",{attrs:{label:" "}},[r("el-button",{attrs:{type:"success"},on:{click:e.testMysqlConnection}},[e._v("测试连通性")])],1)],1),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.inArray(e.groupInfo.store,3),expression:"inArray(groupInfo.store, 3)"}],staticClass:"store-group",attrs:{label:"Mongodb配置"}},[r("el-form-item",{attrs:{label:"MongodbDSN"}},[r("el-input",{attrs:{type:"text",placeholder:"mongodb://username:password@127.0.0.1:27017/?authSource=dbname"},model:{value:e.groupInfo.MongodbDSN,callback:function(t){e.$set(e.groupInfo,"MongodbDSN",t)},expression:"groupInfo.MongodbDSN"}})],1),r("el-form-item",{attrs:{label:" "}},[r("el-button",{attrs:{type:"success"},on:{click:e.testMongodbConnection}},[e._v("测试连通性")])],1)],1),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.inArray(e.groupInfo.store,4),expression:"inArray(groupInfo.store, 4)"}],staticClass:"store-group",attrs:{label:"Databus配置"}},[r("el-form-item",{attrs:{label:"GrpcDSN"}},[r("el-input",{attrs:{type:"text",placeholder:"172.2.1.88:10000"},model:{value:e.groupInfo.GrpcDSN,callback:function(t){e.$set(e.groupInfo,"GrpcDSN",t)},expression:"groupInfo.GrpcDSN"}})],1),r("el-form-item",{attrs:{label:"GrpcAppKey"}},[r("el-input",{attrs:{type:"text",placeholder:"appKey"},model:{value:e.groupInfo.GrpcAppKey,callback:function(t){e.$set(e.groupInfo,"GrpcAppKey",t)},expression:"groupInfo.GrpcAppKey"}})],1),r("el-form-item",{attrs:{label:"GrpcAppSecret"}},[r("el-input",{attrs:{type:"text",placeholder:"appSecret"},model:{value:e.groupInfo.GrpcAppSecret,callback:function(t){e.$set(e.groupInfo,"GrpcAppSecret",t)},expression:"groupInfo.GrpcAppSecret"}})],1),r("el-tag",{staticStyle:{"margin-left":"40px"},attrs:{type:"danger"}},[e._v(" 请参阅文档搭建e2cdatabus服务器，https://github.com/fandypeng/e2cdatabus ")]),r("el-form-item",{attrs:{label:" "}},[r("el-button",{attrs:{type:"primary"},on:{click:e.generateAppKeySecretHandler}},[e._v("获取AppKey和AppSecret")]),r("el-button",{attrs:{type:"success"},on:{click:e.testGRpcConnection}},[e._v("测试连通性")])],1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.saveGroupConfig}},[e._v("保存")])],1)],1)],1),r("el-tab-pane",{attrs:{label:"项目成员"}},[r("el-button",{attrs:{type:"primary"},on:{click:e.handleAddMember}},[e._v("添加成员")]),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.groupInfo.members,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[r("el-table-column",{attrs:{label:"昵称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(t.row.userName))])]}}])}),r("el-table-column",{attrs:{"class-name":"status-col",label:"操作",width:"300",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.showDeleteMember(t),expression:"showDeleteMember(scope)"}],attrs:{type:"danger",size:"small"},on:{click:function(r){return e.handleDeleteMember(t)}}},[e._v("删除")]),r("el-tag",{directives:[{name:"show",rawName:"v-show",value:e.groupInfo.owner==t.row.uid,expression:"groupInfo.owner == scope.row.uid"}]},[e._v("管理员")])]}}])})],1),r("el-dialog",{attrs:{visible:e.addMemberdialogVisible,title:"添加成员",width:"500px"},on:{"update:visible":function(t){e.addMemberdialogVisible=t}}},[r("el-form",{attrs:{"label-width":"80px","label-position":"left"}},[r("el-form-item",{attrs:{label:"名称"}},[r("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入名称:",clearable:"","trigger-on-focus":!1},on:{select:e.handleSelect},model:{value:e.searchUserName,callback:function(t){e.searchUserName=t},expression:"searchUserName"}})],1)],1),r("br"),r("div",{staticStyle:{"text-align":"right"}},[r("el-button",{attrs:{type:"danger"},on:{click:function(t){e.addMemberdialogVisible=!1}}},[e._v("取消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addMember()}}},[e._v("保存")])],1)],1)],1)],1)],1)},n=[],s=(r("99af"),r("4160"),r("c975"),r("a434"),r("b0c0"),r("ac1f"),r("5319"),r("159b"),r("96cf"),r("1da1")),i=r("5530"),a=r("b775");function l(e){return Object(a["a"])({url:"/excel/list",method:"get",params:e})}function c(e){return Object(a["a"])({url:"/excel/delete",method:"post",params:e})}function d(e){return Object(a["a"])({url:"/excel/create",method:"post",params:e})}function u(e){return Object(a["a"])({url:"/excel/update",method:"post",params:e})}function p(e){return Object(a["a"])({url:"/excel/sheet_list",method:"post",params:e})}function g(e){return Object(a["a"])({url:"/excel/export",method:"post",params:e})}function f(e){return Object(a["a"])({url:"/excel/export_prod",method:"post",params:e})}var h=r("c24f"),m=r("23ba"),b=r("2f62"),y=(r("b64b"),r("d3b7"),r("4d63"),r("25f0"),r("4d90"),r("1276"),r("53ca"));function x(e){if(!e&&"object"!==Object(y["a"])(e))throw new Error("error arguments","deepClone");var t=e.constructor===Array?[]:{};return Object.keys(e).forEach((function(r){e[r]&&"object"===Object(y["a"])(e[r])?t[r]=x(e[r]):t[r]=e[r]})),t}var v=r("4eff"),S=r.n(v),w=r("5c96"),I={id:"",name:"",owner:"",remark:"",create_time:"",update_time:""},k={components:{CodeDiff:S.a},computed:Object(i["a"])({},Object(b["b"])(["uid","name"])),filters:{statusFilter:function(e){var t={published:"success",draft:"gray",deleted:"danger"};return t[e]},dateFilter:function(e){return new Date(1e3*parseInt(e)).toLocaleString().replace(/:\d{1,2}$/," ")}},data:function(){return{excel:Object.assign({},I),list:[],listLoading:!0,dialogVisible:!1,dialogType:"new",exportDialogVisible:!1,exportFormat:"",form:{},groupInfo:{name:"贪吃蛇大作战",remark:"这是贪吃蛇大作战App项目",avatar:r("5643"),store:[],GrpcAppKey:"",GrpcAppSecret:"",GrpcDSN:""},storeOptions:[{key:1,name:"Redis"},{key:2,name:"Mysql"},{key:4,name:"Databus"}],addMemberdialogVisible:!1,searchUserName:"",searchUid:"",compareVisable:!1,oldStr:"",newStr:"",sheetList:[],sleectedSheet:"",exportProdDialogVisible:!1,exportRecordDialogVisible:!1,selectRecordId:"",recordList:[],exportRemark:""}},created:function(){this.excel.owner=this.name,this.fetchData()},methods:{fetchData:function(){var e=this;this.listLoading=!0;var t=localStorage.getItem("groupInfo");t=JSON.parse(t),console.log(t),null!=t?(void 0!=t.store&&null!=t.store||(t.store=[]),this.groupInfo=t,l({limit:10,group_id:t.gid}).then((function(t){void 0!=t.data.list&&(e.list=t.data.list),e.listLoading=!1}))):this.$router.push({path:"/"})},handleAddExcel:function(){this.excel=Object.assign({},I),this.excel.owner=this.name,this.dialogType="new",this.dialogVisible=!0},handleSwitchEnv:function(){var e=this,t="当前处于正式环境，是否确认切换到测试环境";this.groupInfo.IsDev&&(t="当前处于测试环境，是否确认切换到正式环境"),w["MessageBox"].confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(t){if(void 0!=t){var r=e.groupInfo.UnionGroupId;Object(m["h"])(r).then((function(t){if(t.data.list.length>0){e.groupInfo=t.data.list[0],localStorage.setItem("groupInfo",JSON.stringify(e.groupInfo));var r=e.$route.path;e.$router.push({path:r,query:{t:+new Date}}),e.fetchData()}}))}})).catch((function(e){console.log(e)}))},confirmExcel:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,o,n,s,i,a,l,c,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==e.excel.name.length){t.next=3;break}return e.$message({type:"warning",message:"请输入名称"}),t.abrupt("return");case 3:if(r="edit"===e.dialogType,!r){t.next=17;break}return t.next=7,u(e.excel);case 7:o=0;case 8:if(!(o<e.list.length)){t.next=15;break}if(e.list[o].id!==e.excel.id){t.next=12;break}return e.list.splice(o,1,Object.assign({},e.excel)),t.abrupt("break",15);case 12:o++,t.next=8;break;case 15:t.next=29;break;case 17:return n=e.excel,n.uid=e.uid,n.group_id=e.groupInfo.gid,t.next=22,d(n);case 22:s=t.sent,i=s.data,e.excel.id=i.eid,a=(new Date).getTime(),e.excel.createTime=a/1e3,e.excel.editTime=a/1e3,e.list.push(e.excel);case 29:l=e.excel,l.id,c=l.name,p=l.remark,e.dialogVisible=!1,e.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:"\n            <div>名称: ".concat(c,"</div>\n            <div>备注: ").concat(p,"</div>\n          "),type:"success"});case 32:case"end":return t.stop()}}),t)})))()},handleEdit:function(e){this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.excel=x(e.row)},handleDelete:function(e){var t=this,r=e.$index,o=e.row;this.$confirm("确定删除表格吗?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c({id:o.id,name:o.name});case 2:t.list.splice(r,1),t.$message({type:"success",message:"删除成功!"});case 4:case"end":return e.stop()}}),e)})))).catch((function(e){console.error(e)}))},handleExport:function(e){var t=this;this.excel=x(e.row),this.exportDialogVisible=!0,this.sheetList=[],this.oldStr="",this.newStr="",this.exportRemark="",p({gridKey:this.excel.id}).then((function(e){0==e.code&&(t.sheetList=e.data.sheetName,console.log(t.sheetList),t.sheetList.length>0&&(t.sleectedSheet=t.sheetList[0]),t.getExcelSheetContent(t.excel.id,t.sleectedSheet),t.getExcelSheetFromDB(t.excel.id,t.sleectedSheet))}))},handleExportProd:function(e){var t=this;this.excel=x(e.row),this.exportProdDialogVisible=!0,this.sheetList=[],this.oldStr="",this.newStr="",p({gridKey:this.excel.id}).then((function(e){0==e.code&&(t.sheetList=e.data.sheetName,console.log(t.sheetList),t.sheetList.length>0&&(t.sleectedSheet=t.sheetList[0]),t.getExcelSheetContent(t.excel.id,t.sleectedSheet),t.getExcelSheetFromProd(t.excel.id,t.sleectedSheet))}))},handleExportRecord:function(e){var t=this;this.excel=x(e.row),this.exportRecordDialogVisible=!0,this.sheetList=[],this.exportRecord=[],this.oldStr="",this.newStr="",p({gridKey:this.excel.id}).then((function(e){0==e.code&&(t.sheetList=e.data.sheetName,console.log(t.sheetList),t.sheetList.length>0&&(t.sleectedSheet=t.sheetList[0]),t.getRecordList())}))},getRecordList:function(){var e=this;Object(m["b"])({gridKey:this.excel.id,sheetName:this.sleectedSheet}).then((function(t){null!=t.data&&(e.recordList=t.data.list),e.recordList.length>0&&(e.selectRecordId=e.recordList[0].id),e.refreshRecordContent()}))},refreshRecordContent:function(){for(var e="",t=0;t<this.recordList.length;t++)this.recordList[t].id==this.selectRecordId&&t+1<this.recordList.length&&(console.log("record：",this.recordList[t+1]),e=this.recordList[t+1].id);this.getExcelSheetFromRecord(this.excel.id,this.sleectedSheet,this.selectRecordId),this.getExcelSheetFromRecord(this.excel.id,this.sleectedSheet,e)},getExcelSheetContent:function(e,t){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function o(){var n,s,i,a;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return r.newStr="",n={},n.gridKey=e,n.sheetName=t,n.format="json",o.next=7,g(n);case 7:s=o.sent,i=s.data,void 0!=i.jsonstr&&i.jsonstr.length>0&&(a=JSON.parse(i.jsonstr),r.newStr=JSON.stringify(a,null," "));case 10:case"end":return o.stop()}}),o)})))()},getExcelSheetFromDB:function(e,t){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function o(){var n,s,i,a;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return r.oldStr="",n={},n.gridKey=e,n.sheetName=t,o.next=6,Object(m["f"])(n);case 6:s=o.sent,i=s.data,void 0!=i.jsonstr&&i.jsonstr.length>0&&(a=JSON.parse(i.jsonstr),r.oldStr=JSON.stringify(a,null," "));case 9:case"end":return o.stop()}}),o)})))()},getExcelSheetFromProd:function(e,t){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function o(){var n,s,i,a;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return r.oldStr="",n={},n.gridKey=e,n.sheetName=t,n.format="json",n.gid=r.groupInfo.gid,o.next=8,f(n);case 8:s=o.sent,i=s.data,void 0!=i.jsonstr&&i.jsonstr.length>0&&(a=JSON.parse(i.jsonstr),r.oldStr=JSON.stringify(a,null," "));case 11:case"end":return o.stop()}}),o)})))()},getExcelSheetFromRecord:function(e,t,r){var o=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var s,i,a,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r==o.selectRecordId?o.newStr="":o.oldStr="",0!=r.length){n.next=3;break}return n.abrupt("return");case 3:return s={},s.gridKey=e,s.sheetName=t,s.recordId=r,s.format="json",n.next=10,Object(m["c"])(s);case 10:i=n.sent,a=i.data,void 0!=a.jsonstr&&a.jsonstr.length>0&&(l=JSON.parse(a.jsonstr),r==o.selectRecordId?o.newStr=JSON.stringify(l,null," "):o.oldStr=JSON.stringify(l,null," "));case 13:case"end":return n.stop()}}),n)})))()},handleRollBack:function(){var e=this,t='您当前选择的配置表是 "'+this.sleectedSheet+'", 确认要回退版本吗？';w["MessageBox"].confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(t){if(void 0!=t){var r={};r.gridKey=e.excel.id,r.sheetName=e.sleectedSheet,r.recordId=e.selectRecordId,Object(m["d"])(r).then((function(t){0!=t.code?e.$notify({title:"回退失败",dangerouslyUseHTMLString:!0,message:t.data.msg,type:"error"}):(e.$notify({title:"回退成功",dangerouslyUseHTMLString:!0,message:"",type:"success"}),e.exportRecordDialogVisible=!1)}))}})).catch((function(e){console.log(e)}))},onSelectedSheetChange:function(e){console.log(e),1==e?(this.getExcelSheetContent(this.excel.id,this.sleectedSheet),this.getExcelSheetFromDB(this.excel.id,this.sleectedSheet)):2==e?(this.getExcelSheetContent(this.excel.id,this.sleectedSheet),this.getExcelSheetFromProd(this.excel.id,this.sleectedSheet)):3==e&&(this.selectRecordId="",this.newStr="",this.oldStr="",this.recordList=[],this.getRecordList())},onSelectRecordChange:function(e){console.log("select record changed"),this.refreshRecordContent()},confirmExport:function(){var e=this;if(0!=this.exportRemark.length){var t='您当前选择的配置表是 "'+this.sleectedSheet+'", 修改备注为 "'+this.exportRemark+'", 确认发布吗？';this.groupInfo.IsDev||(t="当前处于正式环境, "+t),w["MessageBox"].confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(t){var r={};r.gridKey=e.excel.id,r.sheetName=e.sleectedSheet,r.remark=e.exportRemark,Object(m["a"])(r).then((function(t){0==t.code&&(0!=t.code?e.$notify({title:"发布失败",dangerouslyUseHTMLString:!0,message:t.data.msg,type:"error"}):(e.$notify({title:"发布成功",dangerouslyUseHTMLString:!0,message:"",type:"success"}),e.exportDialogVisible=!1))}))}))}else this.$notify({title:"发布失败",dangerouslyUseHTMLString:!0,message:"请填写发布内容",type:"error"})},confirmExportProd:function(){var e=this,t={};t.gridKey=this.excel.id,t.sheetName=this.sleectedSheet,t.gid=this.groupInfo.gid,Object(m["k"])(t).then((function(t){0==t.code&&(0!=t.code?e.$notify({title:"同步失败",dangerouslyUseHTMLString:!0,message:t.data.msg,type:"error"}):(e.$notify({title:"同步成功",dangerouslyUseHTMLString:!0,message:"",type:"success"}),e.exportProdDialogVisible=!1))}))},saveGroupConfig:function(){var e=this;Object(m["j"])({id:this.groupInfo.gid,groupInfo:this.groupInfo}).then((function(t){0!=t.code?e.$notify({title:"保存失败",dangerouslyUseHTMLString:!0,message:t.data.msg,type:"error"}):(e.$notify({title:"保存成功",dangerouslyUseHTMLString:!0,message:"",type:"success"}),localStorage.setItem("groupInfo",JSON.stringify(e.groupInfo)))}))},uploadAvatar:function(e){e.preventDefault(),console.log(e);var t=e.target.files||e.dataTransfer.files;this.checkFile(t[0])&&this.setSourceImg(t[0])},checkFile:function(e){var t=this.lang,r=this.maxSize;return-1===e.type.indexOf("image")?(this.hasError=!0,this.errorMsg=t.error.onlyImg,!1):!(e.size/1024>r)||(this.hasError=!0,this.errorMsg=t.error.outOfSize+r+"kb",!1)},setSourceImg:function(e){var t=this,r=new FileReader;r.onload=function(e){t.groupInfo.avatar=r.result},r.readAsDataURL(e)},inArray:function(e,t){for(var r in e)if(e[r]==t)return!0;return!1},testRedisConnection:function(e){var t=this,r={dsnType:1,dsn:this.groupInfo.RedisDSN,pwd:this.groupInfo.RedisPassword};Object(m["i"])(r).then((function(e){0!=e.data.connected&&void 0!=e.data.connected?t.$notify({title:"Redis连接成功",dangerouslyUseHTMLString:!0,message:"",type:"success"}):t.$notify({title:"Redis连接失败",dangerouslyUseHTMLString:!0,message:"请检查DSN配置或者IP白名单配置",type:"error"})}))},testMysqlConnection:function(){var e=this,t={dsnType:2,dsn:this.groupInfo.MysqlDSN};Object(m["i"])(t).then((function(t){0!=t.data.connected&&void 0!=t.data.connected?e.$notify({title:"Mysql连接成功",dangerouslyUseHTMLString:!0,message:"",type:"success"}):e.$notify({title:"Mysql连接失败",dangerouslyUseHTMLString:!0,message:"请检查DSN配置或者IP白名单配置",type:"error"})}))},testGRpcConnection:function(){var e=this,t={dsnType:4,dsn:this.groupInfo.GrpcDSN,appKey:this.groupInfo.GrpcAppKey,appSecret:this.groupInfo.GrpcAppSecret};Object(m["i"])(t).then((function(t){0!=t.data.connected&&void 0!=t.data.connected?e.$notify({title:"Databus连接成功",dangerouslyUseHTMLString:!0,message:"",type:"success"}):e.$notify({title:"Databus连接失败",dangerouslyUseHTMLString:!0,message:"请启动Databus服务，检查DSN和AppKey、AppSecret配置",type:"error"})}))},generateAppKeySecretHandler:function(){var e=this;Object(m["e"])().then((function(t){null!=t.data&&""!=t.data.appKey&&""!=t.data.appSecret?(e.$notify({title:"获取成功",dangerouslyUseHTMLString:!0,message:"请参阅文档搭建e2cdatabus服务器",type:"success"}),e.groupInfo.GrpcDSN="",e.groupInfo.GrpcAppKey=t.data.appKey,e.groupInfo.GrpcAppSecret=t.data.appSecret):e.$notify({title:"获取失败",dangerouslyUseHTMLString:!0,message:"请联系管理员",type:"error"})}))},testMongodbConnection:function(){var e=this,t={dsnType:3,dsn:this.groupInfo.MongodbDSN};Object(m["i"])(t).then((function(t){0!=t.data.connected&&void 0!=t.data.connected?e.$notify({title:"Mongodb连接成功",dangerouslyUseHTMLString:!0,message:"",type:"success"}):e.$notify({title:"Mongodb连接失败",dangerouslyUseHTMLString:!0,message:"请检查DSN配置或者IP白名单配置",type:"error"})}))},showDeleteMember:function(e){return this.groupInfo.owner==this.uid&&this.groupInfo.owner!=e.row.uid},handleAddMember:function(){this.addMemberdialogVisible=!0},addMember:function(){var e=this,t=!1;this.groupInfo.members.forEach((function(r){r.uid!=e.searchUid||(t=!0)})),t?this.$notify({title:"添加失败",dangerouslyUseHTMLString:!0,message:"成员已存在",type:"error"}):(this.groupInfo.members.push({uid:this.searchUid,userName:this.searchUserName}),this.updateGroupInfo("保存成功","添加成员："+this.searchUserName),this.addMemberdialogVisible=!1)},handleSelect:function(e){this.searchUid=e.id},handleDeleteMember:function(e){var t=[];this.groupInfo.members.forEach((function(r){r.uid!=e.row.uid&&t.push(r)})),this.groupInfo.members=t,this.updateGroupInfo("保存成功","删除成员："+e.row.userName)},updateGroupInfo:function(e,t){var r=this;Object(m["j"])({id:this.groupInfo.gid,groupInfo:this.groupInfo}).then((function(o){0!=o.code?r.$notify({title:"保存失败",dangerouslyUseHTMLString:!0,message:o.data.msg,type:"error"}):(r.$notify({title:e,dangerouslyUseHTMLString:!0,message:t,type:"success"}),localStorage.setItem("groupInfo",JSON.stringify(r.groupInfo)))}))},querySearchAsync:function(e,t){var r=[];this.searchUid="",""!=e?Object(h["e"])({name:this.searchUserName}).then((function(e){void 0!=e.data.userInfos&&null!=e.data.userInfos?(e.data.userInfos.forEach((function(e){r.push({id:e.uid,value:e.userName})})),console.log(r),t(r)):t(r)})):t(r)}}},_=k,N=(r("6ed3"),r("2877")),R=Object(N["a"])(_,o,n,!1,null,"59d8e5b8",null);t["default"]=R.exports}}]);