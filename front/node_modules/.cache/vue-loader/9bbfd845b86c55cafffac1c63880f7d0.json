{"remainingRequest":"/Users/Fandy/workspace/e2c/front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/Fandy/workspace/e2c/front/src/views/LuckySheet/LuckySheet.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/Fandy/workspace/e2c/front/src/views/LuckySheet/LuckySheet.vue","mtime":1612683957691},{"path":"/Users/Fandy/workspace/e2c/front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/Fandy/workspace/e2c/front/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/Fandy/workspace/e2c/front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/Fandy/workspace/e2c/front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBMdWNreUV4Y2VsIGZyb20gJ2x1Y2t5ZXhjZWwnOwppbXBvcnQgeyB0aXRsZSB9IGZyb20gJ0Avc2V0dGluZ3MnOwppbXBvcnQgeyBnZXRUb2tlbiB9IGZyb20gJ0AvdXRpbHMvYXV0aCc7CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdMdWNreVNoZWV0JywKICBwcm9wczogewogICAgbXNnOiBTdHJpbmcKICB9LAogIGRhdGEoKXsKICAgIHJldHVybiB7CiAgICAgIHNlbGVjdGVkOiIiLAogICAgICBpc01hc2tTaG93OiBmYWxzZSwKICAgICAgZ3JpZEtleTogdGhpcy4kcm91dGUucGFyYW1zLm5hbWUsCiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgLi4ubWFwR2V0dGVycyhbCiAgICAgICd1aWQnCiAgICBdKQogIH0sCiAgbW91bnRlZCgpIHsKICAgIHZhciB2bSA9IHRoaXMKICAgIC8vIEluIHNvbWUgY2FzZXMsIHlvdSBuZWVkIHRvIHVzZSAkbmV4dFRpY2sKICAgIC8vIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgICQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBsdWNreXNoZWV0LmNyZWF0ZSh7CiAgICAgICAgICAgICAgY29udGFpbmVyOiAibHVja3lzaGVldCIsCiAgICAgICAgICAgICAgYWxsb3dFZGl0OnRydWUsCiAgICAgICAgICAgICAgYWxsb3dVcGRhdGU6IHRydWUsIC8v5piv5ZCm5YWB6K6457yW6L6R5ZCO55qE5ZCO5Y+w5pu05pawCiAgICAgICAgICAgICAgZ3JpZEtleTogdm0uJHJvdXRlLnBhcmFtcy5pZCwKICAgICAgICAgICAgICBsb2FkVXJsOiAiaHR0cDovLzEyNy4wLjAuMTo4MDAwL2V4Y2VsP3VpZD0iK3ZtLnVpZCsiJnRva2VuPSIrZ2V0VG9rZW4oKSwgLy8g6YWN572ubG9hZFVybOeahOWcsOWdgO+8jGx1Y2t5c2hlZXTkvJrpgJrov4dhamF46K+35rGC6KGo5qC85pWw5o2u77yM6buY6K6k6L295YWlc3RhdHVz5Li6MeeahHNoZWV05pWw5o2u5Lit55qE5omA5pyJZGF0Ye+8jOWFtuS9meeahHNoZWV06L295YWl6ZmkZGF0YeWtl+auteWklueahOaJgOacieWtl+autQogICAgICAgICAgICAgIGxvYWRTaGVldFVybDogImh0dHA6Ly8xMjcuMC4wLjE6ODAwMC9leGNlbC9zaGVldD91aWQ9Iit2bS51aWQrIiZ0b2tlbj0iK2dldFRva2VuKCksIC8v6YWN572ubG9hZFNoZWV0VXJs55qE5Zyw5Z2A77yM5Y+C5pWw5Li6Z3JpZEtlee+8iOihqOagvOS4u+mUru+8iSDlkowgaW5kZXjvvIhzaGVldOS4u+mUruWQiOmbhu+8jOagvOW8j+S4ulsxLDIsM13vvInvvIzov5Tlm57nmoTmlbDmja7kuLpzaGVldOeahGRhdGHlrZfmrrXmlbDmja7pm4blkIgKICAgICAgICAgICAgICB1cGRhdGVVcmw6ICJ3czovLzEyNy4wLjAuMTo4MDAxL3VpZC8iK3ZtLnVpZCsiL3Rva2VuLyIrZ2V0VG9rZW4oKSwgLy/ooajmoLzmlbDmja7nmoTmm7TmlrDlnLDlnYAKICAgICAgICAgICAgICBteUZvbGRlclVybDogIiMvY29uZmlnL2luZGV4IiwKICAgICAgICAgICAgICB0aXRsZTogdm0uJHJvdXRlLnBhcmFtcy5uYW1lLAogICAgICAgICAgICAgIGxhbmc6ICJ6aCIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgCiAgICAvLyB9KTsKICB9LAogIGRlc3Ryb3llZCAoKSB7CiAgICAvLyBjb25zb2xlLmxvZyhsdWNreXNoZWV0KQogICAgbHVja3lzaGVldC5jbG9zZVdlYnNvY2tldCgpCiAgICBsdWNreXNoZWV0LmRlc3Ryb3koKQogIH0sCiAgbWV0aG9kczp7CiAgICB1cGxvYWRFeGNlbChldnQpewogICAgICAgIGNvbnN0IGZpbGVzID0gZXZ0LnRhcmdldC5maWxlczsKICAgICAgICBpZihmaWxlcz09bnVsbCB8fCBmaWxlcy5sZW5ndGg9PTApewogICAgICAgICAgICBhbGVydCgiTm8gZmlsZXMgd2FpdCBmb3IgaW1wb3J0Iik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGxldCBuYW1lID0gZmlsZXNbMF0ubmFtZTsKICAgICAgICBsZXQgc3VmZml4QXJyID0gbmFtZS5zcGxpdCgiLiIpLCBzdWZmaXggPSBzdWZmaXhBcnJbc3VmZml4QXJyLmxlbmd0aC0xXTsKICAgICAgICBpZihzdWZmaXghPSJ4bHN4Iil7CiAgICAgICAgICAgIGFsZXJ0KCJDdXJyZW50bHkgb25seSBzdXBwb3J0cyB0aGUgaW1wb3J0IG9mIHhsc3ggZmlsZXMiKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBMdWNreUV4Y2VsLnRyYW5zZm9ybUV4Y2VsVG9MdWNreShmaWxlc1swXSwgZnVuY3Rpb24oZXhwb3J0SnNvbiwgbHVja3lzaGVldGZpbGUpewogICAgICAgICAgICAKICAgICAgICAgICAgaWYoZXhwb3J0SnNvbi5zaGVldHM9PW51bGwgfHwgZXhwb3J0SnNvbi5zaGVldHMubGVuZ3RoPT0wKXsKICAgICAgICAgICAgICAgIGFsZXJ0KCJGYWlsZWQgdG8gcmVhZCB0aGUgY29udGVudCBvZiB0aGUgZXhjZWwgZmlsZSwgY3VycmVudGx5IGRvZXMgbm90IHN1cHBvcnQgeGxzIGZpbGVzISIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpbmRvdy5sdWNreXNoZWV0LmRlc3Ryb3koKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHdpbmRvdy5sdWNreXNoZWV0LmNyZWF0ZSh7CiAgICAgICAgICAgICAgICBjb250YWluZXI6ICdsdWNreXNoZWV0JywgLy9sdWNreXNoZWV0IGlzIHRoZSBjb250YWluZXIgaWQKICAgICAgICAgICAgICAgIHNob3dpbmZvYmFyOmZhbHNlLAogICAgICAgICAgICAgICAgZGF0YTpleHBvcnRKc29uLnNoZWV0cywKICAgICAgICAgICAgICAgIHRpdGxlOmV4cG9ydEpzb24uaW5mby5uYW1lLAogICAgICAgICAgICAgICAgdXNlckluZm86ZXhwb3J0SnNvbi5pbmZvLm5hbWUuY3JlYXRvcgogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0sCiAgICBzZWxlY3RFeGNlbChldnQpewogICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5zZWxlY3RlZDsKICAgICAgICBjb25zdCBuYW1lID0gZXZ0LnRhcmdldC5vcHRpb25zW2V2dC50YXJnZXQuc2VsZWN0ZWRJbmRleF0uaW5uZXJUZXh0OwogICAgICAgIAogICAgICAgIGlmKHZhbHVlPT0iIil7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5pc01hc2tTaG93ID0gdHJ1ZTsKCiAgICAgICAgTHVja3lFeGNlbC50cmFuc2Zvcm1FeGNlbFRvTHVja3lCeVVybCh2YWx1ZSwgbmFtZSwgKGV4cG9ydEpzb24sIGx1Y2t5c2hlZXRmaWxlKSA9PiB7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZihleHBvcnRKc29uLnNoZWV0cz09bnVsbCB8fCBleHBvcnRKc29uLnNoZWV0cy5sZW5ndGg9PTApewogICAgICAgICAgICAgICAgYWxlcnQoIkZhaWxlZCB0byByZWFkIHRoZSBjb250ZW50IG9mIHRoZSBleGNlbCBmaWxlLCBjdXJyZW50bHkgZG9lcyBub3Qgc3VwcG9ydCB4bHMgZmlsZXMhIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuaXNNYXNrU2hvdyA9IGZhbHNlOwogICAgICAgICAgICB3aW5kb3cubHVja3lzaGVldC5kZXN0cm95KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB3aW5kb3cubHVja3lzaGVldC5jcmVhdGUoewogICAgICAgICAgICAgICAgY29udGFpbmVyOiAnbHVja3lzaGVldCcsIC8vbHVja3lzaGVldCBpcyB0aGUgY29udGFpbmVyIGlkCiAgICAgICAgICAgICAgICBzaG93aW5mb2JhcjpmYWxzZSwKICAgICAgICAgICAgICAgIGRhdGE6ZXhwb3J0SnNvbi5zaGVldHMsCiAgICAgICAgICAgICAgICB0aXRsZTpleHBvcnRKc29uLmluZm8ubmFtZSwKICAgICAgICAgICAgICAgIHVzZXJJbmZvOmV4cG9ydEpzb24uaW5mby5uYW1lLmNyZWF0b3IKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9LAogICAgZG93bmxvYWRFeGNlbCgpewogICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnNlbGVjdGVkOzsKCiAgICAgICAgICBpZih2YWx1ZS5sZW5ndGg9PTApewogICAgICAgICAgICAgIGFsZXJ0KCJQbGVhc2Ugc2VsZWN0IGEgZGVtbyBmaWxlIik7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBlbGVtSUYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiTHVja3ktZG93bmxvYWQtZnJhbWUiKTsKICAgICAgICAgIGlmKGVsZW1JRj09bnVsbCl7CiAgICAgICAgICAgICAgZWxlbUlGID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaWZyYW1lIik7CiAgICAgICAgICAgICAgZWxlbUlGLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICAgICAgZWxlbUlGLmlkID0gIkx1Y2t5LWRvd25sb2FkLWZyYW1lIjsKICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1JRik7CiAgICAgICAgICB9CiAgICAgICAgICBlbGVtSUYuc3JjID0gdmFsdWU7CiAgICB9CgogIH0KfQo="},{"version":3,"sources":["LuckySheet.vue"],"names":[],"mappings":";;;;;;;AAOA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"LuckySheet.vue","sourceRoot":"src/views/LuckySheet","sourcesContent":["<template>\n  <div id=\"luckysheet\"\n      style=\"margin:0px;padding:0px;position:absolute;width:100%;left: 0px;top: 0px;bottom:0px;height:100%;display:block;\"\n    ></div>\n</template>\n\n<script>\nimport LuckyExcel from 'luckyexcel';\nimport { title } from '@/settings';\nimport { getToken } from '@/utils/auth';\nimport { mapGetters } from 'vuex'\n\nexport default {\n  name: 'LuckySheet',\n  props: {\n    msg: String\n  },\n  data(){\n    return {\n      selected:\"\",\n      isMaskShow: false,\n      gridKey: this.$route.params.name,\n    }\n  },\n  computed: {\n    ...mapGetters([\n      'uid'\n    ])\n  },\n  mounted() {\n    var vm = this\n    // In some cases, you need to use $nextTick\n    // this.$nextTick(() => {\n          $(function () {\n            luckysheet.create({\n              container: \"luckysheet\",\n              allowEdit:true,\n              allowUpdate: true, //是否允许编辑后的后台更新\n              gridKey: vm.$route.params.id,\n              loadUrl: \"http://127.0.0.1:8000/excel?uid=\"+vm.uid+\"&token=\"+getToken(), // 配置loadUrl的地址，luckysheet会通过ajax请求表格数据，默认载入status为1的sheet数据中的所有data，其余的sheet载入除data字段外的所有字段\n              loadSheetUrl: \"http://127.0.0.1:8000/excel/sheet?uid=\"+vm.uid+\"&token=\"+getToken(), //配置loadSheetUrl的地址，参数为gridKey（表格主键） 和 index（sheet主键合集，格式为[1,2,3]），返回的数据为sheet的data字段数据集合\n              updateUrl: \"ws://127.0.0.1:8001/uid/\"+vm.uid+\"/token/\"+getToken(), //表格数据的更新地址\n              myFolderUrl: \"#/config/index\",\n              title: vm.$route.params.name,\n              lang: \"zh\"\n            });\n          });\n      \n    // });\n  },\n  destroyed () {\n    // console.log(luckysheet)\n    luckysheet.closeWebsocket()\n    luckysheet.destroy()\n  },\n  methods:{\n    uploadExcel(evt){\n        const files = evt.target.files;\n        if(files==null || files.length==0){\n            alert(\"No files wait for import\");\n            return;\n        }\n\n        let name = files[0].name;\n        let suffixArr = name.split(\".\"), suffix = suffixArr[suffixArr.length-1];\n        if(suffix!=\"xlsx\"){\n            alert(\"Currently only supports the import of xlsx files\");\n            return;\n        }\n        LuckyExcel.transformExcelToLucky(files[0], function(exportJson, luckysheetfile){\n            \n            if(exportJson.sheets==null || exportJson.sheets.length==0){\n                alert(\"Failed to read the content of the excel file, currently does not support xls files!\");\n                return;\n            }\n            window.luckysheet.destroy();\n            \n            window.luckysheet.create({\n                container: 'luckysheet', //luckysheet is the container id\n                showinfobar:false,\n                data:exportJson.sheets,\n                title:exportJson.info.name,\n                userInfo:exportJson.info.name.creator\n            });\n        });\n    },\n    selectExcel(evt){\n        const value = this.selected;\n        const name = evt.target.options[evt.target.selectedIndex].innerText;\n        \n        if(value==\"\"){\n            return;\n        }\n        this.isMaskShow = true;\n\n        LuckyExcel.transformExcelToLuckyByUrl(value, name, (exportJson, luckysheetfile) => {\n            \n            if(exportJson.sheets==null || exportJson.sheets.length==0){\n                alert(\"Failed to read the content of the excel file, currently does not support xls files!\");\n                return;\n            }\n            \n            this.isMaskShow = false;\n            window.luckysheet.destroy();\n            \n            window.luckysheet.create({\n                container: 'luckysheet', //luckysheet is the container id\n                showinfobar:false,\n                data:exportJson.sheets,\n                title:exportJson.info.name,\n                userInfo:exportJson.info.name.creator\n            });\n        });\n    },\n    downloadExcel(){\n          const value = this.selected;;\n\n          if(value.length==0){\n              alert(\"Please select a demo file\");\n              return;\n          }\n\n          var elemIF = document.getElementById(\"Lucky-download-frame\");\n          if(elemIF==null){\n              elemIF = document.createElement(\"iframe\");\n              elemIF.style.display = \"none\";\n              elemIF.id = \"Lucky-download-frame\";\n              document.body.appendChild(elemIF);\n          }\n          elemIF.src = value;\n    }\n\n  }\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\nh3 {\n  margin: 40px 0 0;\n}\nul {\n  list-style-type: none;\n  padding: 0;\n}\nli {\n  display: inline-block;\n  margin: 0 10px;\n}\na {\n  color: #42b983;\n}\n</style>\n"]}]}