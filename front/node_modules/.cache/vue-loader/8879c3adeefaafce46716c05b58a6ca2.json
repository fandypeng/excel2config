{"remainingRequest":"/Users/Fandy/go/src/excel2config/front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/Fandy/go/src/excel2config/front/src/views/table/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/Fandy/go/src/excel2config/front/src/views/table/index.vue","mtime":1620734509917},{"path":"/Users/Fandy/go/src/excel2config/front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/Fandy/go/src/excel2config/front/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/Fandy/go/src/excel2config/front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/Fandy/go/src/excel2config/front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldExpc3QsIGRlbGV0ZUV4Y2VsLCB1cGRhdGVFeGNlbCwgYWRkRXhjZWwsIGV4cG9ydEV4Y2VsLCBnZXRTaGVldExpc3QsIGV4cG9ydEV4Y2VsUHJvZCB9IGZyb20gJ0AvYXBpL3NoZWV0JwppbXBvcnQgeyBzZWFyY2hVc2VyIH0gZnJvbSAnQC9hcGkvdXNlcicKaW1wb3J0IHsgZ3JvdXBVcGRhdGUsIGdyb3VwVGVzdENvbm5lY3Rpb24sIGdldENvbmZpZ0Zyb21EQiwgZXhwb3J0Q29uZmlnVG9EQiwgZ2VuZXJhdGVBcHBLZXlTZWNyZXQsCiAgZ3JvdXBMaXN0LCBzeW5jVG9Qcm9kLCBleHBvcnRSZWNvcmQsIGV4cG9ydFJlY29yZENvbnRlbnQsIGV4cG9ydFJvbGxiYWNrIH0gZnJvbSAnQC9hcGkvZ3JvdXAnCmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JwppbXBvcnQgeyBkZWVwQ2xvbmUgfSBmcm9tICdAL3V0aWxzJwppbXBvcnQgQ29kZURpZmYgZnJvbSAndnVlLWNvZGUtZGlmZicKaW1wb3J0IHsgTWVzc2FnZUJveCB9IGZyb20gJ2VsZW1lbnQtdWknCgpjb25zdCBkZWZhdWx0RXhjZWwgPSB7CiAgaWQ6ICcnLAogIG5hbWU6ICcnLAogIG93bmVyOiAnJywKICByZW1hcms6ICcnLAogIGNyZWF0ZV90aW1lOiAnJywKICB1cGRhdGVfdGltZTogJycKfQoKY29uc3QgUm9sZSA9IHsKICBBZG1pbjogMSwKICBEZXZlbG9wZXI6IDIKfQpjb25zdCByb2xlQ29uZmlnID0gWwogIHsgJ3JvbGUnOiAxLCAnbmFtZSc6ICfnrqHnkIblkZgnIH0sCiAgeyAncm9sZSc6IDIsICduYW1lJzogJ+W8gOWPkeiAhScgfQpdCgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogeyBDb2RlRGlmZiB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBHZXR0ZXJzKFsKICAgICAgJ3VpZCcsCiAgICAgICduYW1lJwogICAgXSkKICB9LAogIGZpbHRlcnM6IHsKICAgIHN0YXR1c0ZpbHRlcihzdGF0dXMpIHsKICAgICAgY29uc3Qgc3RhdHVzTWFwID0gewogICAgICAgIHB1Ymxpc2hlZDogJ3N1Y2Nlc3MnLAogICAgICAgIGRyYWZ0OiAnZ3JheScsCiAgICAgICAgZGVsZXRlZDogJ2RhbmdlcicKICAgICAgfQogICAgICByZXR1cm4gc3RhdHVzTWFwW3N0YXR1c10KICAgIH0sCiAgICBkYXRlRmlsdGVyKGRhdGV0aW1lKSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZShwYXJzZUludChkYXRldGltZSkgKiAxMDAwKS50b0xvY2FsZVN0cmluZygpLnJlcGxhY2UoLzpcZHsxLDJ9JC8sJyAnKTsKICAgIH0sCiAgICByb2xlRmlsdGVyKHJvbGUpIHsKICAgICAgaWYgKHJvbGUgPT09IHVuZGVmaW5lZCB8fCByb2xlID09PSBudWxsKSB7CiAgICAgICAgcm9sZSA9IFJvbGUuRGV2ZWxvcGVyCiAgICAgIH0KICAgICAgaWYgKHJvbGVDb25maWcubGVuZ3RoID49IHJvbGUpIHsKICAgICAgICByZXR1cm4gcm9sZUNvbmZpZ1sgcm9sZSAtIDEgXS5uYW1lCiAgICAgIH0KICAgICAgcmV0dXJuICfmnKrlrprkuYknCiAgICB9CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZXhjZWw6IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRFeGNlbCksCiAgICAgIGxpc3Q6IFtdLAogICAgICBsaXN0TG9hZGluZzogdHJ1ZSwKICAgICAgZGlhbG9nTG9hZGluZzogZmFsc2UsCiAgICAgIGRpYWxvZ1Zpc2libGU6IGZhbHNlLAogICAgICBkaWFsb2dUeXBlOiAnbmV3JywKICAgICAgZXhwb3J0RGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgIGV4cG9ydEZvcm1hdDogJycsCiAgICAgIGZvcm06IHt9LAogICAgICBncm91cEluZm86IHsKICAgICAgICBuYW1lOiAn6LSq5ZCD6JuH5aSn5L2c5oiYJywKICAgICAgICByZW1hcms6ICfov5nmmK/otKrlkIPom4flpKfkvZzmiJhBcHDpobnnm64nLAogICAgICAgIGF2YXRhcjogcmVxdWlyZSgnLi4vLi4vaWNvbnMvdGFuY2hpc2hlLWljb24ucG5nJyksCiAgICAgICAgc3RvcmU6IFtdCiAgICAgIH0sCiAgICAgIHN0b3JlT3B0aW9uczogWwogICAgICAgIHsga2V5OiAxLCBuYW1lOiAnUmVkaXMnIH0sCiAgICAgICAgeyBrZXk6IDIsIG5hbWU6ICdNeXNxbCcgfSwKICAgICAgICAvLyB7a2V5OiAnTW9uZ29kYicsIG5hbWU6ICdNb25nb2RiJ30sCiAgICAgICAgeyBrZXk6IDQsIG5hbWU6ICdEYXRhYnVzJyB9CiAgICAgIF0sCiAgICAgIGFkZE1lbWJlcmRpYWxvZ1Zpc2libGU6IGZhbHNlLAogICAgICBzZWFyY2hVc2VyTmFtZTogJycsCiAgICAgIHNlYXJjaFVpZDogJycsCiAgICAgIGNvbXBhcmVWaXNhYmxlOiBmYWxzZSwKICAgICAgc2hlZXRMaXN0OiBbXSwKICAgICAgc2xlZWN0ZWRTaGVldDogJycsCiAgICAgIGV4cG9ydFByb2REaWFsb2dWaXNpYmxlOiBmYWxzZSwKICAgICAgZXhwb3J0UmVjb3JkRGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgIHNlbGVjdFJlY29yZElkOiAnJywKICAgICAgcmVjb3JkTGlzdDogW10sCiAgICAgIGV4cG9ydFJlbWFyazogJycsCiAgICAgIGNvbnRleHRSb3dMZW5ndGg6IDEwLAogICAgICBjb2RlRGlmZjogewogICAgICAgIGJlZm9yZUV4cG9ydFN0cjogJycsCiAgICAgICAgZXhwb3J0U3RyOiAnJywKICAgICAgICBiZWZvcmVFeHBvcnRQcm9kU3RyOiAnJywKICAgICAgICBleHBvcnRQcm9kU3RyOiAnJywKICAgICAgICBiZWZvcmVFeHBvcnRSZWNvcmRTdHI6ICcnLAogICAgICAgIGV4cG9ydFJlY29yZFN0cjogJycKICAgICAgfSwKICAgICAgcm9sZU5hbWVzOiByb2xlQ29uZmlnCiAgICB9CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5leGNlbC5vd25lciA9IHRoaXMubmFtZQogICAgdGhpcy5mZXRjaERhdGEoKQogIH0sCiAgbWV0aG9kczogewogICAgZmV0Y2hEYXRhKCkgewogICAgICB0aGlzLmxpc3RMb2FkaW5nID0gdHJ1ZQogICAgICB2YXIgZ3JvdXBJbmZvID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dyb3VwSW5mbycpCiAgICAgIGdyb3VwSW5mbyA9IEpTT04ucGFyc2UoZ3JvdXBJbmZvKQogICAgICBjb25zb2xlLmxvZyhncm91cEluZm8pCiAgICAgIGlmIChncm91cEluZm8gPT09IG51bGwpIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICBwYXRoOiAnLycKICAgICAgICB9KQogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIGlmIChncm91cEluZm8uc3RvcmUgPT09IHVuZGVmaW5lZCB8fCBncm91cEluZm8uc3RvcmUgPT09IG51bGwpIHsKICAgICAgICBncm91cEluZm8uc3RvcmUgPSBbXQogICAgICB9CiAgICAgIHRoaXMuZ3JvdXBJbmZvID0gZ3JvdXBJbmZvCiAgICAgIHRoaXMuZ3JvdXBJbmZvLm1lbWJlcnMuZm9yRWFjaChtID0+IHsKICAgICAgICBpZiAobS51aWQgPT09IHRoaXMudWlkICYmIChtLnJvbGUgPT09IDAgfHwgbS5yb2xlID09PSB1bmRlZmluZWQpKSB7CiAgICAgICAgICBtLnJvbGUgPSBSb2xlLkFkbWluCiAgICAgICAgfQogICAgICB9KQogICAgICBnZXRMaXN0KHtsaW1pdDogMTAsIGdyb3VwX2lkOiBncm91cEluZm8uZ2lkfSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubGlzdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLmxpc3QgPSByZXNwb25zZS5kYXRhLmxpc3QKICAgICAgICB9CiAgICAgICAgdGhpcy5saXN0TG9hZGluZyA9IGZhbHNlCiAgICAgIH0pCiAgICB9LAogICAgaGFuZGxlQWRkRXhjZWwoKSB7CiAgICAgIHRoaXMuZXhjZWwgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0RXhjZWwpLAogICAgICB0aGlzLmV4Y2VsLm93bmVyID0gdGhpcy5uYW1lCiAgICAgIHRoaXMuZGlhbG9nVHlwZSA9ICduZXcnCiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWUKICAgIH0sCiAgICBoYW5kbGVTd2l0Y2hFbnYoKSB7CiAgICAgIHZhciB0ZXh0ID0gJ+W9k+WJjeWkhOS6juato+W8j+eOr+Wig++8jOaYr+WQpuehruiupOWIh+aNouWIsOa1i+ivleeOr+WigycKICAgICAgaWYgKHRoaXMuZ3JvdXBJbmZvLklzRGV2KSB7CiAgICAgICAgdGV4dCA9ICflvZPliY3lpITkuo7mtYvor5Xnjq/looPvvIzmmK/lkKbnoa7orqTliIfmjaLliLDmraPlvI/njq/looMnCiAgICAgIH0KICAgICAgTWVzc2FnZUJveC5jb25maXJtKHRleHQsICfmj5DnpLonLCB7CiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7lrponLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflj5bmtognLAogICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgdmFyIHVuaW9uR2lkID0gdGhpcy5ncm91cEluZm8uVW5pb25Hcm91cElkCiAgICAgICAgZ3JvdXBMaXN0KHVuaW9uR2lkKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmxpc3QgIT09IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLmxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICB0aGlzLmdyb3VwSW5mbyA9IHJlc3BvbnNlLmRhdGEubGlzdFswXQogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZ3JvdXBJbmZvJywgSlNPTi5zdHJpbmdpZnkodGhpcy5ncm91cEluZm8pKQogICAgICAgICAgICAvLyByZWZyZXNoCiAgICAgICAgICAgIHZhciBwYXRoID0gdGhpcy4kcm91dGUucGF0aAogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgcGF0aCwKICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgdDogK25ldyBEYXRlKCkgLy/kv53or4Hmr4/mrKHngrnlh7vot6/nlLHnmoRxdWVyeemhuemDveaYr+S4jeS4gOagt+eahO+8jOehruS/neS8mumHjeaWsOWIt+aWsHZpZXcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHRoaXMuZmV0Y2hEYXRhKCkKICAgICAgICAgIH0gZWxzZXsKICAgICAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgICAgdHlwZTogJ3dhcm5pbmcnLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICfmmoLml6DmnYPpmZDvvIzor7fogZTns7vnrqHnkIblkZjmt7vliqDmnYPpmZAnCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZSkKICAgICAgfSkKICAgIH0sCiAgICBhc3luYyBjb25maXJtRXhjZWwoKSB7CiAgICAgIGlmICh0aGlzLmV4Y2VsLm5hbWUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICB0eXBlOiAnd2FybmluZycsCiAgICAgICAgICBtZXNzYWdlOiAn6K+36L6T5YWl5ZCN56ewJwogICAgICAgIH0pCiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgY29uc3QgaXNFZGl0ID0gdGhpcy5kaWFsb2dUeXBlID09PSAnZWRpdCcKICAgICAgaWYgKGlzRWRpdCkgewogICAgICAgIGF3YWl0IHVwZGF0ZUV4Y2VsKHRoaXMuZXhjZWwpCiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubGlzdC5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgIGlmICh0aGlzLmxpc3RbaW5kZXhdLmlkID09PSB0aGlzLmV4Y2VsLmlkKSB7CiAgICAgICAgICAgIHRoaXMubGlzdC5zcGxpY2UoaW5kZXgsIDEsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZXhjZWwpKQogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgcGFyYW1zID0gdGhpcy5leGNlbAogICAgICAgIHBhcmFtcy51aWQgPSB0aGlzLnVpZAogICAgICAgIHBhcmFtcy5ncm91cF9pZCA9IHRoaXMuZ3JvdXBJbmZvLmdpZAogICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYWRkRXhjZWwocGFyYW1zKQogICAgICAgIHRoaXMuZXhjZWwuaWQgPSBkYXRhLmVpZAogICAgICAgIHZhciB0aW1lc3RhbXA9bmV3IERhdGUoKS5nZXRUaW1lKCkKICAgICAgICB0aGlzLmV4Y2VsLmNyZWF0ZVRpbWUgPSB0aW1lc3RhbXAvMTAwMAogICAgICAgIHRoaXMuZXhjZWwuZWRpdFRpbWUgPSB0aW1lc3RhbXAvMTAwMAogICAgICAgIHRoaXMubGlzdC5wdXNoKHRoaXMuZXhjZWwpCiAgICAgIH0KCiAgICAgIGNvbnN0IHsgaWQsIG5hbWUsIHJlbWFyayB9ID0gdGhpcy5leGNlbAogICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSBmYWxzZQogICAgICB0aGlzLiRub3RpZnkoewogICAgICAgIHRpdGxlOiAnU3VjY2VzcycsCiAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgIG1lc3NhZ2U6IGAKICAgICAgICAgICAgPGRpdj7lkI3np7A6ICR7bmFtZX08L2Rpdj4KICAgICAgICAgICAgPGRpdj7lpIfms6g6ICR7cmVtYXJrfTwvZGl2PgogICAgICAgICAgYCwKICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgfSkKICAgIH0sCiAgICBoYW5kbGVFZGl0KHNjb3BlKSB7CiAgICAgIHRoaXMuZGlhbG9nVHlwZSA9ICdlZGl0JwogICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSB0cnVlCiAgICAgIHRoaXMuY2hlY2tTdHJpY3RseSA9IHRydWUKICAgICAgdGhpcy5leGNlbCA9IGRlZXBDbG9uZShzY29wZS5yb3cpCiAgICB9LAogICAgaGFuZGxlRGVsZXRlKHskaW5kZXgsIHJvd30pIHsKICAgICAgdGhpcy4kY29uZmlybSgn56Gu5a6a5Yig6Zmk6KGo5qC85ZCXPycsICdXYXJuaW5nJywgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu5a6aJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgfSkudGhlbihhc3luYygpID0+IHsKICAgICAgICBhd2FpdCBkZWxldGVFeGNlbCh7aWQ6IHJvdy5pZCwgbmFtZTogcm93Lm5hbWV9KQogICAgICAgIHRoaXMubGlzdC5zcGxpY2UoJGluZGV4LCAxKQogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLAogICAgICAgICAgbWVzc2FnZTogJ+WIoOmZpOaIkOWKnyEnCiAgICAgICAgfSkKICAgICAgfSkuY2F0Y2goZXJyID0+IHsgY29uc29sZS5lcnJvcihlcnIpIH0pCiAgICB9LAogICAgaGFuZGxlRXhwb3J0KHNjb3BlKSB7CiAgICAgIHRoaXMuZXhjZWwgPSBkZWVwQ2xvbmUoc2NvcGUucm93KQogICAgICB0aGlzLmV4cG9ydERpYWxvZ1Zpc2libGUgPSB0cnVlCiAgICAgIHRoaXMuc2hlZXRMaXN0ID0gW10KICAgICAgdGhpcy5jb2RlRGlmZi5iZWZvcmVFeHBvcnRTdHIgPSAnJwogICAgICB0aGlzLmNvZGVEaWZmLmV4cG9ydFN0ciA9ICcnCiAgICAgIHRoaXMuZXhwb3J0UmVtYXJrID0gJycKICAgICAgdGhpcy5kaWFsb2dMb2FkaW5nID0gdHJ1ZQogICAgICBnZXRTaGVldExpc3Qoe2dyaWRLZXk6IHRoaXMuZXhjZWwuaWR9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuY29kZSA9PT0gMCkgewogICAgICAgICAgdGhpcy5zaGVldExpc3QgPSByZXNwb25zZS5kYXRhLnNoZWV0TmFtZQogICAgICAgICAgY29uc29sZS5sb2codGhpcy5zaGVldExpc3QpCiAgICAgICAgICBpZiAodGhpcy5zaGVldExpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICB0aGlzLnNsZWVjdGVkU2hlZXQgPSB0aGlzLnNoZWV0TGlzdFswXQogICAgICAgICAgfQogICAgICAgICAgdGhpcy5nZXRFeGNlbFNoZWV0Q29udGVudCh0aGlzLmV4Y2VsLmlkLCB0aGlzLnNsZWVjdGVkU2hlZXQpCiAgICAgICAgICB0aGlzLmdldEV4Y2VsU2hlZXRGcm9tREIodGhpcy5leGNlbC5pZCwgdGhpcy5zbGVlY3RlZFNoZWV0KQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICBoYW5kbGVFeHBvcnRQcm9kKHNjb3BlKSB7CiAgICAgIHRoaXMuZXhjZWwgPSBkZWVwQ2xvbmUoc2NvcGUucm93KQogICAgICB0aGlzLmV4cG9ydFByb2REaWFsb2dWaXNpYmxlID0gdHJ1ZQogICAgICB0aGlzLnNoZWV0TGlzdCA9IFtdCiAgICAgIHRoaXMuY29kZURpZmYuYmVmb3JlRXhwb3J0UHJvZFN0ciA9ICcnCiAgICAgIHRoaXMuY29kZURpZmYuZXhwb3J0UHJvZFN0ciA9ICcnCiAgICAgIHRoaXMuZGlhbG9nTG9hZGluZyA9IHRydWUKICAgICAgZ2V0U2hlZXRMaXN0KHtncmlkS2V5OiB0aGlzLmV4Y2VsLmlkfSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmNvZGUgPT09IDApIHsKICAgICAgICAgIHRoaXMuc2hlZXRMaXN0ID0gcmVzcG9uc2UuZGF0YS5zaGVldE5hbWUKICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuc2hlZXRMaXN0KQogICAgICAgICAgaWYgKHRoaXMuc2hlZXRMaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhpcy5zbGVlY3RlZFNoZWV0ID0gdGhpcy5zaGVldExpc3RbMF0KICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuZ2V0RXhjZWxTaGVldENvbnRlbnQodGhpcy5leGNlbC5pZCwgdGhpcy5zbGVlY3RlZFNoZWV0KQogICAgICAgICAgdGhpcy5nZXRFeGNlbFNoZWV0RnJvbVByb2QodGhpcy5leGNlbC5pZCwgdGhpcy5zbGVlY3RlZFNoZWV0KQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICBoYW5kbGVFeHBvcnRSZWNvcmQoc2NvcGUpIHsKICAgICAgdGhpcy5leGNlbCA9IGRlZXBDbG9uZShzY29wZS5yb3cpCiAgICAgIHRoaXMuZXhwb3J0UmVjb3JkRGlhbG9nVmlzaWJsZSA9IHRydWUKICAgICAgdGhpcy5zaGVldExpc3QgPSBbXQogICAgICB0aGlzLmV4cG9ydFJlY29yZCA9IFtdCiAgICAgIHRoaXMuY29kZURpZmYuYmVmb3JlRXhwb3J0UmVjb3JkU3RyID0gJycKICAgICAgdGhpcy5jb2RlRGlmZi5leHBvcnRSZWNvcmRTdHIgPSAnJwogICAgICB0aGlzLmRpYWxvZ0xvYWRpbmcgPSB0cnVlCiAgICAgIGdldFNoZWV0TGlzdCh7Z3JpZEtleTogdGhpcy5leGNlbC5pZH0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5jb2RlID09PSAwKSB7CiAgICAgICAgICB0aGlzLnNoZWV0TGlzdCA9IHJlc3BvbnNlLmRhdGEuc2hlZXROYW1lCiAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnNoZWV0TGlzdCkKICAgICAgICAgIGlmICh0aGlzLnNoZWV0TGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRoaXMuc2xlZWN0ZWRTaGVldCA9IHRoaXMuc2hlZXRMaXN0WzBdCiAgICAgICAgICB9CiAgICAgICAgICAvLyDojrflj5ZyZWNvcmQgbGlzdAogICAgICAgICAgdGhpcy5nZXRSZWNvcmRMaXN0KCkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgZ2V0UmVjb3JkTGlzdCgpIHsKICAgICAgZXhwb3J0UmVjb3JkKHtncmlkS2V5OiB0aGlzLmV4Y2VsLmlkLCBzaGVldE5hbWU6IHRoaXMuc2xlZWN0ZWRTaGVldH0pLnRoZW4ocmVzcCA9PiB7CiAgICAgICAgaWYgKHJlc3AuZGF0YSAhPT0gbnVsbCkgewogICAgICAgICAgdGhpcy5yZWNvcmRMaXN0ID0gcmVzcC5kYXRhLmxpc3QKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMucmVjb3JkTGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdFJlY29yZElkID0gdGhpcy5yZWNvcmRMaXN0WzBdLmlkCiAgICAgICAgfQogICAgICAgIHRoaXMucmVmcmVzaFJlY29yZENvbnRlbnQoKQogICAgICB9KQogICAgfSwKICAgIHJlZnJlc2hSZWNvcmRDb250ZW50KCkgewogICAgICB2YXIgbGFzdFJlY29yZElkID0gJycKICAgICAgLy8g5Yik5pat5piv5ZCm5pyJ5LiK5LiA5LiqcmVjb3JkCiAgICAgIGZvciAodmFyIGk9MDtpPHRoaXMucmVjb3JkTGlzdC5sZW5ndGg7aSsrKSB7CiAgICAgICAgaWYgKHRoaXMucmVjb3JkTGlzdFtpXS5pZCA9PT0gdGhpcy5zZWxlY3RSZWNvcmRJZCkgewogICAgICAgICAgaWYgKGkrMTx0aGlzLnJlY29yZExpc3QubGVuZ3RoKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZWNvcmTvvJonLCB0aGlzLnJlY29yZExpc3RbaSsxXSkKICAgICAgICAgICAgbGFzdFJlY29yZElkID0gdGhpcy5yZWNvcmRMaXN0W2krMV0uaWQKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5nZXRFeGNlbFNoZWV0RnJvbVJlY29yZCh0aGlzLmV4Y2VsLmlkLCB0aGlzLnNsZWVjdGVkU2hlZXQsIHRoaXMuc2VsZWN0UmVjb3JkSWQpCiAgICAgIHRoaXMuZ2V0RXhjZWxTaGVldEZyb21SZWNvcmQodGhpcy5leGNlbC5pZCwgdGhpcy5zbGVlY3RlZFNoZWV0LCBsYXN0UmVjb3JkSWQpCiAgICB9LAogICAgYXN5bmMgZ2V0RXhjZWxTaGVldENvbnRlbnQoZ3JpZEtleSwgc2hlZXROYW1lKSB7CiAgICAgIHRoaXMuY29kZURpZmYuZXhwb3J0U3RyID0gJycKICAgICAgdmFyIHBhcmFtcyA9IHt9CiAgICAgIHBhcmFtcy5ncmlkS2V5ID0gZ3JpZEtleQogICAgICBwYXJhbXMuc2hlZXROYW1lID0gc2hlZXROYW1lCiAgICAgIHBhcmFtcy5mb3JtYXQgPSAnanNvbicKICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBleHBvcnRFeGNlbChwYXJhbXMpCiAgICAgIGlmIChkYXRhLmpzb25zdHIgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmpzb25zdHIubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMuY29kZURpZmYuZXhwb3J0U3RyID0gZGF0YS5qc29uc3RyCiAgICAgICAgdGhpcy5jb2RlRGlmZi5leHBvcnRQcm9kU3RyID0gZGF0YS5qc29uc3RyCiAgICAgICAgdGhpcy5kaWFsb2dMb2FkaW5nID0gZmFsc2UKICAgICAgfQogICAgfSwKICAgIGFzeW5jIGdldEV4Y2VsU2hlZXRGcm9tREIoZ3JpZEtleSwgc2hlZXROYW1lKSB7CiAgICAgIHRoaXMuY29kZURpZmYuYmVmb3JlRXhwb3J0U3RyID0gJycKICAgICAgdmFyIHBhcmFtcyA9IHt9CiAgICAgIHBhcmFtcy5ncmlkS2V5ID0gZ3JpZEtleQogICAgICBwYXJhbXMuc2hlZXROYW1lID0gc2hlZXROYW1lCiAgICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgZ2V0Q29uZmlnRnJvbURCKHBhcmFtcykKICAgICAgaWYgKGRhdGEuanNvbnN0ciAhPT0gdW5kZWZpbmVkICYmIGRhdGEuanNvbnN0ci5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5jb2RlRGlmZi5iZWZvcmVFeHBvcnRTdHIgPSBkYXRhLmpzb25zdHIKICAgICAgICB0aGlzLmRpYWxvZ0xvYWRpbmcgPSBmYWxzZQogICAgICB9CiAgICB9LAogICAgYXN5bmMgZ2V0RXhjZWxTaGVldEZyb21Qcm9kKGdyaWRLZXksIHNoZWV0TmFtZSkgewogICAgICB0aGlzLmNvZGVEaWZmLmJlZm9yZUV4cG9ydFByb2RTdHIgPSAnJwogICAgICB2YXIgcGFyYW1zID0ge30KICAgICAgcGFyYW1zLmdyaWRLZXkgPSBncmlkS2V5CiAgICAgIHBhcmFtcy5zaGVldE5hbWUgPSBzaGVldE5hbWUKICAgICAgcGFyYW1zLmZvcm1hdCA9ICdqc29uJwogICAgICBwYXJhbXMuZ2lkID0gdGhpcy5ncm91cEluZm8uZ2lkCiAgICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgZXhwb3J0RXhjZWxQcm9kKHBhcmFtcykKICAgICAgaWYgKGRhdGEuanNvbnN0ciAhPT0gdW5kZWZpbmVkICYmIGRhdGEuanNvbnN0ci5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5jb2RlRGlmZi5iZWZvcmVFeHBvcnRQcm9kU3RyID0gZGF0YS5qc29uc3RyCiAgICAgICAgdGhpcy5kaWFsb2dMb2FkaW5nID0gZmFsc2UKICAgICAgfQogICAgfSwKICAgIGFzeW5jIGdldEV4Y2VsU2hlZXRGcm9tUmVjb3JkKGdyaWRLZXksIHNoZWV0TmFtZSwgcmVjb3JkSWQpIHsKICAgICAgaWYgKHJlY29yZElkID09PSB0aGlzLnNlbGVjdFJlY29yZElkKSB7CiAgICAgICAgdGhpcy5jb2RlRGlmZi5leHBvcnRSZWNvcmRTdHIgPSAnJwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY29kZURpZmYuYmVmb3JlRXhwb3J0UmVjb3JkU3RyID0gJycKICAgICAgfQogICAgICBpZiAocmVjb3JkSWQubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgdmFyIHBhcmFtcyA9IHt9CiAgICAgIHBhcmFtcy5ncmlkS2V5ID0gZ3JpZEtleQogICAgICBwYXJhbXMuc2hlZXROYW1lID0gc2hlZXROYW1lCiAgICAgIHBhcmFtcy5yZWNvcmRJZCA9IHJlY29yZElkCiAgICAgIHBhcmFtcy5mb3JtYXQgPSAnanNvbicKICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBleHBvcnRSZWNvcmRDb250ZW50KHBhcmFtcykKICAgICAgaWYgKGRhdGEuanNvbnN0ciAhPT0gdW5kZWZpbmVkICYmIGRhdGEuanNvbnN0ci5sZW5ndGggPiAwKSB7CiAgICAgICAgaWYgKHJlY29yZElkID09PSB0aGlzLnNlbGVjdFJlY29yZElkKSB7CiAgICAgICAgICB0aGlzLmNvZGVEaWZmLmV4cG9ydFJlY29yZFN0ciA9IGRhdGEuanNvbnN0cgogICAgICAgICAgdGhpcy5kaWFsb2dMb2FkaW5nID0gZmFsc2UKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5jb2RlRGlmZi5iZWZvcmVFeHBvcnRSZWNvcmRTdHIgPSBkYXRhLmpzb25zdHIKICAgICAgICAgIHRoaXMuZGlhbG9nTG9hZGluZyA9IGZhbHNlCiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaGFuZGxlUm9sbEJhY2soKSB7CiAgICAgIHZhciB0ZXh0ID0gJ+aCqOW9k+WJjemAieaLqeeahOmFjee9ruihqOaYryBcIicgKyB0aGlzLnNsZWVjdGVkU2hlZXQgKyAnXCIsIOehruiupOimgeWbnumAgOeJiOacrOWQl++8nycKICAgICAgTWVzc2FnZUJveC5jb25maXJtKHRleHQsICfmj5DnpLonLCB7CiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7lrponLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflj5bmtognLAogICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgdmFyIHBhcmFtcyA9IHt9CiAgICAgICAgcGFyYW1zLmdyaWRLZXkgPSB0aGlzLmV4Y2VsLmlkCiAgICAgICAgcGFyYW1zLnNoZWV0TmFtZSA9IHRoaXMuc2xlZWN0ZWRTaGVldAogICAgICAgIHBhcmFtcy5yZWNvcmRJZCA9IHRoaXMuc2VsZWN0UmVjb3JkSWQKICAgICAgICBleHBvcnRSb2xsYmFjayhwYXJhbXMpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmNvZGUgIT09IDApIHsKICAgICAgICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgICAgICAgdGl0bGU6ICflm57pgIDlpLHotKUnLAogICAgICAgICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgICAgICAgbWVzc2FnZTogcmVzcG9uc2UuZGF0YS5tc2csCiAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgICAgICAgdGl0bGU6ICflm57pgIDmiJDlip8nLAogICAgICAgICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgICAgICAgbWVzc2FnZTogJycsCiAgICAgICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIHRoaXMuZXhwb3J0UmVjb3JkRGlhbG9nVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICApCiAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgIGNvbnNvbGUubG9nKGUpCiAgICAgIH0pCiAgICB9LAogICAgb25TZWxlY3RlZFNoZWV0Q2hhbmdlKGUpIHsKICAgICAgdGhpcy5kaWFsb2dMb2FkaW5nID0gdHJ1ZQogICAgICBpZiAoZSA9PT0gMSkgeyAvLyDlj5HluIPlvLnnqpcKICAgICAgICB0aGlzLmxpc3RMb2FkaW5nID0gdHJ1ZQogICAgICAgIHRoaXMuZ2V0RXhjZWxTaGVldENvbnRlbnQodGhpcy5leGNlbC5pZCwgdGhpcy5zbGVlY3RlZFNoZWV0KQogICAgICAgIHRoaXMuZ2V0RXhjZWxTaGVldEZyb21EQih0aGlzLmV4Y2VsLmlkLCB0aGlzLnNsZWVjdGVkU2hlZXQpCiAgICAgICAgdGhpcy5saXN0TG9hZGluZyA9IGZhbHNlCiAgICAgIH0gZWxzZSBpZiAoZSA9PT0gMikgeyAvLyDlkIzmraXlvLnnqpcKICAgICAgICB0aGlzLmdldEV4Y2VsU2hlZXRDb250ZW50KHRoaXMuZXhjZWwuaWQsIHRoaXMuc2xlZWN0ZWRTaGVldCkKICAgICAgICB0aGlzLmdldEV4Y2VsU2hlZXRGcm9tUHJvZCh0aGlzLmV4Y2VsLmlkLCB0aGlzLnNsZWVjdGVkU2hlZXQpCiAgICAgIH0gZWxzZSBpZiAoZSA9PT0gMykgeyAvL+WPkeW4g+iusOW9leW8ueeqlwogICAgICAgIHRoaXMuc2VsZWN0UmVjb3JkSWQgPSAnJwogICAgICAgIHRoaXMuY29kZURpZmYuYmVmb3JlRXhwb3J0UmVjb3JkU3RyID0gJycKICAgICAgICB0aGlzLmNvZGVEaWZmLmV4cG9ydFJlY29yZFN0ciA9ICcnCiAgICAgICAgdGhpcy5yZWNvcmRMaXN0ID0gW10KICAgICAgICB0aGlzLmdldFJlY29yZExpc3QoKQogICAgICB9CiAgICB9LAogICAgb25TZWxlY3RSZWNvcmRDaGFuZ2UoZSkgewogICAgICBjb25zb2xlLmxvZygnc2VsZWN0IHJlY29yZCBjaGFuZ2VkJykKICAgICAgdGhpcy5yZWZyZXNoUmVjb3JkQ29udGVudCgpCiAgICB9LAogICAgY29uZmlybUV4cG9ydCgpIHsKICAgICAgaWYgKHRoaXMuZXhwb3J0UmVtYXJrLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICB0aXRsZTogJ+WPkeW4g+Wksei0pScsCiAgICAgICAgICBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsCiAgICAgICAgICBtZXNzYWdlOiAn6K+35aGr5YaZ5Y+R5biD5YaF5a65JywKICAgICAgICAgIHR5cGU6ICdlcnJvcicKICAgICAgICB9KQogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIHZhciB0ZXh0ID0gJ+aCqOW9k+WJjemAieaLqeeahOmFjee9ruihqOaYryBcIicgKyB0aGlzLnNsZWVjdGVkU2hlZXQgKyAnXCIsIOS/ruaUueWkh+azqOS4uiBcIicrdGhpcy5leHBvcnRSZW1hcmsgKyAnXCIsIOehruiupOWPkeW4g+WQl++8nycKICAgICAgaWYgKCF0aGlzLmdyb3VwSW5mby5Jc0RldikgewogICAgICAgIHRleHQgPSAn5b2T5YmN5aSE5LqO5q2j5byP546v5aKDLCAnICsgdGV4dAogICAgICB9CiAgICAgIE1lc3NhZ2VCb3guY29uZmlybSh0ZXh0LCAn5o+Q56S6JywgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu5a6aJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgIHZhciBwYXJhbXMgPSB7fQogICAgICAgIHBhcmFtcy5ncmlkS2V5ID0gdGhpcy5leGNlbC5pZAogICAgICAgIHBhcmFtcy5zaGVldE5hbWUgPSB0aGlzLnNsZWVjdGVkU2hlZXQKICAgICAgICBwYXJhbXMucmVtYXJrID0gdGhpcy5leHBvcnRSZW1hcmsKICAgICAgICBleHBvcnRDb25maWdUb0RCKHBhcmFtcykudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2UuY29kZSA9PT0gMCkgewogICAgICAgICAgICBpZiAocmVzcG9uc2UuY29kZSAhPT0gMCkgewogICAgICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgICAgICB0aXRsZTogJ+WPkeW4g+Wksei0pScsCiAgICAgICAgICAgICAgICBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsCiAgICAgICAgICAgICAgICBtZXNzYWdlOiByZXNwb25zZS5kYXRhLm1zZywKICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgICAgICB0aXRsZTogJ+WPkeW4g+aIkOWKnycsCiAgICAgICAgICAgICAgICBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsCiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnJywKICAgICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgdGhpcy5leHBvcnREaWFsb2dWaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0pCiAgICB9LAogICAgY29uZmlybUV4cG9ydFByb2QoKSB7CiAgICAgIHZhciBwYXJhbXMgPSB7fQogICAgICBwYXJhbXMuZ3JpZEtleSA9IHRoaXMuZXhjZWwuaWQKICAgICAgcGFyYW1zLnNoZWV0TmFtZSA9IHRoaXMuc2xlZWN0ZWRTaGVldAogICAgICBwYXJhbXMuZ2lkID0gdGhpcy5ncm91cEluZm8uZ2lkCiAgICAgIHN5bmNUb1Byb2QocGFyYW1zKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuY29kZSA9PT0gMCkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmNvZGUgIT09IDApIHsKICAgICAgICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICAgICAgICB0aXRsZTogJ+WQjOatpeWksei0pScsCiAgICAgICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlLmRhdGEubXNnLAogICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicKICAgICAgICAgICAgfSkKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgICAgdGl0bGU6ICflkIzmraXmiJDlip8nLAogICAgICAgICAgICAgIGRhbmdlcm91c2x5VXNlSFRNTFN0cmluZzogdHJ1ZSwKICAgICAgICAgICAgICBtZXNzYWdlOiAnJywKICAgICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgICAgICAgfSkKICAgICAgICAgICAgdGhpcy5leHBvcnRQcm9kRGlhbG9nVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIGV4cG9ydEpzb25GaWxlKCkgewogICAgICB0aGlzLmRvd25sb2FkSnNvbkZpbGUodGhpcy5jb2RlRGlmZi5iZWZvcmVFeHBvcnRTdHIsIHRoaXMuc2xlZWN0ZWRTaGVldCArICcuanNvbicpCiAgICB9LAogICAgZG93bmxvYWRKc29uRmlsZShjb250ZW50LCBmaWxlbmFtZSkgewogICAgICB2YXIgZWxlTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKQogICAgICBlbGVMaW5rLmRvd25sb2FkID0gZmlsZW5hbWUKICAgICAgZWxlTGluay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnCiAgICAgIC8vIOWtl+espuWGheWuuei9rOWPmOaIkGJsb2LlnLDlnYAKICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbY29udGVudF0pCiAgICAgIGVsZUxpbmsuaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYikKICAgICAgLy8g6Kem5Y+R54K55Ye7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlTGluaykKICAgICAgZWxlTGluay5jbGljaygpCiAgICAgIC8vIOeEtuWQjuenu+mZpAogICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZUxpbmspCiAgICB9LAogICAgc2F2ZUdyb3VwQ29uZmlnKCkgewogICAgICBncm91cFVwZGF0ZSh7aWQ6IHRoaXMuZ3JvdXBJbmZvLmdpZCwgZ3JvdXBJbmZvOiB0aGlzLmdyb3VwSW5mb30pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5jb2RlICE9PSAwKSB7CiAgICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgICB0aXRsZTogJ+S/neWtmOWksei0pScsCiAgICAgICAgICAgIGRhbmdlcm91c2x5VXNlSFRNTFN0cmluZzogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogcmVzcG9uc2UuZGF0YS5tc2csCiAgICAgICAgICAgIHR5cGU6ICdlcnJvcicKICAgICAgICAgIH0pCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgIHRpdGxlOiAn5L+d5a2Y5oiQ5YqfJywKICAgICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiAnJywKICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgICAgICB9KQogICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2dyb3VwSW5mbycsIEpTT04uc3RyaW5naWZ5KHRoaXMuZ3JvdXBJbmZvKSkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgdXBsb2FkQXZhdGFyKGUpIHsKICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpCiAgICAgIGNvbnNvbGUubG9nKGUpCiAgICAgIGNvbnN0IGZpbGVzID0gZS50YXJnZXQuZmlsZXMgfHwgZS5kYXRhVHJhbnNmZXIuZmlsZXMKICAgICAgaWYgKHRoaXMuY2hlY2tGaWxlKGZpbGVzWzBdKSkgewogICAgICAgIHRoaXMuc2V0U291cmNlSW1nKGZpbGVzWzBdKQogICAgICB9CiAgICB9LAogICAgLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KICAgIC8vIOajgOa1i+mAieaLqeeahOaWh+S7tuaYr+WQpuWQiOmAggogICAgY2hlY2tGaWxlKGZpbGUpIHsKICAgICAgY29uc3QgeyBsYW5nLCBtYXhTaXplIH0gPSB0aGlzCiAgICAgIC8vIOS7hemZkOWbvueJhwogICAgICBpZiAoZmlsZS50eXBlLmluZGV4T2YoJ2ltYWdlJykgPT09IC0xKSB7CiAgICAgICAgdGhpcy5oYXNFcnJvciA9IHRydWUKICAgICAgICB0aGlzLmVycm9yTXNnID0gbGFuZy5lcnJvci5vbmx5SW1nCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0KICAgICAgLy8g6LaF5Ye65aSn5bCPCiAgICAgIGlmIChmaWxlLnNpemUgLyAxMDI0ID4gbWF4U2l6ZSkgewogICAgICAgIHRoaXMuaGFzRXJyb3IgPSB0cnVlCiAgICAgICAgdGhpcy5lcnJvck1zZyA9IGxhbmcuZXJyb3Iub3V0T2ZTaXplICsgbWF4U2l6ZSArICdrYicKICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZQogICAgfSwKICAgIHNldFNvdXJjZUltZyhmaWxlKSB7CiAgICAgIGNvbnN0IGZyID0gbmV3IEZpbGVSZWFkZXIoKQogICAgICBmci5vbmxvYWQgPSBlID0+IHsKICAgICAgICB0aGlzLmdyb3VwSW5mby5hdmF0YXIgPSBmci5yZXN1bHQKICAgICAgfQogICAgICBmci5yZWFkQXNEYXRhVVJMKGZpbGUpCiAgICB9LAogICAgaW5BcnJheShhcnIsIHRhcmdldCkgewogICAgICBmb3IgKHZhciBpIGluIGFycikgewogICAgICAgIGlmIChhcnJbaV0gPT09IHRhcmdldCkgewogICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlCiAgICB9LAogICAgdGVzdFJlZGlzQ29ubmVjdGlvbihlKSB7CiAgICAgIHZhciBwYXJhbXMgPSB7ZHNuVHlwZToxLGRzbjp0aGlzLmdyb3VwSW5mby5SZWRpc0RTTixwd2Q6dGhpcy5ncm91cEluZm8uUmVkaXNQYXNzd29yZH0KICAgICAgZ3JvdXBUZXN0Q29ubmVjdGlvbihwYXJhbXMpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmNvbm5lY3RlZCA9PT0gMCB8fCByZXNwb25zZS5kYXRhLmNvbm5lY3RlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgICB0aXRsZTogJ1JlZGlz6L+e5o6l5aSx6LSlJywKICAgICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiBg6K+35qOA5p+lRFNO6YWN572u5oiW6ICFSVDnmb3lkI3ljZXphY3nva5gLAogICAgICAgICAgICB0eXBlOiAnZXJyb3InCiAgICAgICAgICB9KQogICAgICAgICAgcmV0dXJuCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgIHRpdGxlOiAnUmVkaXPov57mjqXmiJDlip8nLAogICAgICAgICAgICBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6IGBgLAogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIHRlc3RNeXNxbENvbm5lY3Rpb24oKSB7CiAgICAgIHZhciBwYXJhbXMgPSB7ZHNuVHlwZToyLGRzbjp0aGlzLmdyb3VwSW5mby5NeXNxbERTTn0KICAgICAgZ3JvdXBUZXN0Q29ubmVjdGlvbihwYXJhbXMpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmNvbm5lY3RlZCA9PT0gMCB8fCByZXNwb25zZS5kYXRhLmNvbm5lY3RlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgICB0aXRsZTogJ015c3Fs6L+e5o6l5aSx6LSlJywKICAgICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiBg6K+35qOA5p+lRFNO6YWN572u5oiW6ICFSVDnmb3lkI3ljZXphY3nva5gLAogICAgICAgICAgICB0eXBlOiAnZXJyb3InCiAgICAgICAgICB9KQogICAgICAgICAgcmV0dXJuCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgIHRpdGxlOiAnTXlzcWzov57mjqXmiJDlip8nLAogICAgICAgICAgICBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6IGBgLAogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIHRlc3RHUnBjQ29ubmVjdGlvbigpIHsKICAgICAgdmFyIHBhcmFtcyA9IHsKICAgICAgICBkc25UeXBlOiA0LAogICAgICAgIGRzbjogICAgdGhpcy5ncm91cEluZm8uR3JwY0RTTiwKICAgICAgICBhcHBLZXk6IHRoaXMuZ3JvdXBJbmZvLkdycGNBcHBLZXksCiAgICAgICAgYXBwU2VjcmV0OiB0aGlzLmdyb3VwSW5mby5HcnBjQXBwU2VjcmV0LAogICAgICB9CiAgICAgIGdyb3VwVGVzdENvbm5lY3Rpb24ocGFyYW1zKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5jb25uZWN0ZWQgPT09IDAgfHwgcmVzcG9uc2UuZGF0YS5jb25uZWN0ZWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICAgICAgdGl0bGU6ICdEYXRhYnVz6L+e5o6l5aSx6LSlJywKICAgICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiBg6K+35ZCv5YqoRGF0YWJ1c+acjeWKoe+8jOajgOafpURTTuWSjEFwcEtleeOAgUFwcFNlY3JldOmFjee9rmAsCiAgICAgICAgICAgIHR5cGU6ICdlcnJvcicKICAgICAgICAgIH0pCiAgICAgICAgICByZXR1cm4KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICAgICAgdGl0bGU6ICdEYXRhYnVz6L+e5o6l5oiQ5YqfJywKICAgICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiBgYCwKICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICBnZW5lcmF0ZUFwcEtleVNlY3JldEhhbmRsZXIoKSB7CiAgICAgIHRoaXMuJHNldCh0aGlzLmdyb3VwSW5mbywgJ0dycGNEU04nLCAnJykKICAgICAgZ2VuZXJhdGVBcHBLZXlTZWNyZXQoKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSA9PT0gbnVsbCB8fCByZXNwb25zZS5kYXRhLmFwcEtleSA9PT0gJycgfHwgcmVzcG9uc2UuZGF0YS5hcHBTZWNyZXQgPT09ICcnKSB7CiAgICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgICB0aXRsZTogJ+iOt+WPluWksei0pScsCiAgICAgICAgICAgIGRhbmdlcm91c2x5VXNlSFRNTFN0cmluZzogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogYOivt+iBlOezu+euoeeQhuWRmGAsCiAgICAgICAgICAgIHR5cGU6ICdlcnJvcicKICAgICAgICAgIH0pCiAgICAgICAgICByZXR1cm4KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICAgICAgdGl0bGU6ICfojrflj5bmiJDlip8nLAogICAgICAgICAgICBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6IGDor7flj4LpmIXmlofmoaPmkK3lu7plMmNkYXRhYnVz5pyN5Yqh5ZmoYCwKICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgICAgICB9KQogICAgICAgICAgdGhpcy4kc2V0KHRoaXMuZ3JvdXBJbmZvLCAnR3JwY0FwcEtleScsIHJlc3BvbnNlLmRhdGEuYXBwS2V5KQogICAgICAgICAgdGhpcy4kc2V0KHRoaXMuZ3JvdXBJbmZvLCAnR3JwY0FwcFNlY3JldCcsIHJlc3BvbnNlLmRhdGEuYXBwU2VjcmV0KQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICBnZW5lcmF0ZUFjY2Vzc1Rva2VuKCkgewogICAgICB0aGlzLiRzZXQodGhpcy5ncm91cEluZm8sICdBY2Nlc3NUb2tlbicsICcnKQogICAgICBnZW5lcmF0ZUFwcEtleVNlY3JldCgpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhID09PSBudWxsIHx8IHJlc3BvbnNlLmRhdGEuYXBwS2V5ID09PSAnJyB8fCByZXNwb25zZS5kYXRhLmFwcFNlY3JldCA9PT0gJycpIHsKICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgIHRpdGxlOiAn6I635Y+W5aSx6LSlJywKICAgICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiBg6K+36IGU57O7566h55CG5ZGYYCwKICAgICAgICAgICAgdHlwZTogJ2Vycm9yJwogICAgICAgICAgfSkKICAgICAgICAgIHJldHVybgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgICB0aXRsZTogJ+WIt+aWsOaIkOWKnycsCiAgICAgICAgICAgIGRhbmdlcm91c2x5VXNlSFRNTFN0cmluZzogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogYOS/neWtmOWQjuWNs+WPr+eUn+aViGAsCiAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJwogICAgICAgICAgfSkKICAgICAgICAgIHRoaXMuJHNldCh0aGlzLmdyb3VwSW5mbywgJ0FjY2Vzc1Rva2VuJywgcmVzcG9uc2UuZGF0YS5hcHBTZWNyZXQpCiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIHRlc3RNb25nb2RiQ29ubmVjdGlvbigpIHsKICAgICAgdmFyIHBhcmFtcyA9IHsgZHNuVHlwZTogMywgZHNuOiB0aGlzLmdyb3VwSW5mby5Nb25nb2RiRFNOIH0KICAgICAgZ3JvdXBUZXN0Q29ubmVjdGlvbihwYXJhbXMpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmNvbm5lY3RlZCA9PT0gMCB8fCByZXNwb25zZS5kYXRhLmNvbm5lY3RlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgICB0aXRsZTogJ01vbmdvZGLov57mjqXlpLHotKUnLAogICAgICAgICAgICBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6IGDor7fmo4Dmn6VEU07phY3nva7miJbogIVJUOeZveWQjeWNlemFjee9rmAsCiAgICAgICAgICAgIHR5cGU6ICdlcnJvcicKICAgICAgICAgIH0pCiAgICAgICAgICByZXR1cm4KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICAgICAgdGl0bGU6ICdNb25nb2Ri6L+e5o6l5oiQ5YqfJywKICAgICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiBgYCwKICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICBzaG93RGVsZXRlQnRuKHNjb3BlKSB7CiAgICAgIGlmICh0aGlzLnVpZCA9PT0gc2NvcGUucm93LnVpZCkgewogICAgICAgIHJldHVybiBmYWxzZQogICAgICB9CiAgICAgIGxldCBpc0FkbWluID0gZmFsc2UKICAgICAgdGhpcy5ncm91cEluZm8ubWVtYmVycy5mb3JFYWNoKG0gPT4gewogICAgICAgIGlmIChtLnVpZCA9PT0gdGhpcy51aWQpIHsKICAgICAgICAgIGlzQWRtaW4gPSBtLnJvbGUgPT09IFJvbGUuQWRtaW4KICAgICAgICB9CiAgICAgIH0pCiAgICAgIHJldHVybiBpc0FkbWluCiAgICB9LAogICAgaGFuZGxlQWRkTWVtYmVyKCkgewogICAgICB0aGlzLmFkZE1lbWJlcmRpYWxvZ1Zpc2libGUgPSB0cnVlCiAgICB9LAogICAgYWRkTWVtYmVyKCkgewogICAgICB2YXIgZXhpc3QgPSBmYWxzZQogICAgICB0aGlzLmdyb3VwSW5mby5tZW1iZXJzLmZvckVhY2gobSA9PiB7CiAgICAgICAgaWYgKG0udWlkID09PSB0aGlzLnNlYXJjaFVpZCkgewogICAgICAgICAgZXhpc3QgPSB0cnVlCiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgIH0pCiAgICAgIGlmIChleGlzdCkgewogICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICB0aXRsZTogJ+a3u+WKoOWksei0pScsCiAgICAgICAgICBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsCiAgICAgICAgICBtZXNzYWdlOiBg5oiQ5ZGY5bey5a2Y5ZyoYCwKICAgICAgICAgIHR5cGU6ICdlcnJvcicKICAgICAgICB9KQogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIHRoaXMuZ3JvdXBJbmZvLm1lbWJlcnMucHVzaCh7CiAgICAgICAgdWlkOiB0aGlzLnNlYXJjaFVpZCwKICAgICAgICB1c2VyTmFtZTogdGhpcy5zZWFyY2hVc2VyTmFtZSwKICAgICAgICByb2xlOiBSb2xlLkRldmVsb3BlcgogICAgICB9KQogICAgICB0aGlzLnVwZGF0ZUdyb3VwSW5mbygn5L+d5a2Y5oiQ5YqfJywgJ+a3u+WKoOaIkOWRmO+8micrdGhpcy5zZWFyY2hVc2VyTmFtZSkKICAgICAgdGhpcy5hZGRNZW1iZXJkaWFsb2dWaXNpYmxlID0gZmFsc2UKICAgIH0sCiAgICBvbkNoYW5nZVVzZXJSb2xlKHNjb3BlKSB7CiAgICAgIHZhciByb2xlID0gc2NvcGUucm93LnJvbGUKICAgICAgdGhpcy5ncm91cEluZm8ubWVtYmVycy5mb3JFYWNoKG0gPT4gewogICAgICAgIGlmIChtLnVpZCA9PT0gdGhpcy5zZWFyY2hVaWQpIHsKICAgICAgICAgIGlmIChtLnJvbGUgPT09IHJvbGUpIHsKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICB9CiAgICAgICAgICBtLnJvbGUgPSByb2xlCiAgICAgICAgfQogICAgICB9KQogICAgICB0aGlzLnVwZGF0ZUdyb3VwSW5mbygn5L+d5a2Y5oiQ5YqfJywgJ+S/ruaUuScgKyBzY29wZS5yb3cudXNlck5hbWUgKyAn5Li677yaJyArIHRoaXMucm9sZU5hbWVzW3JvbGUgLSAxXS5uYW1lKQogICAgfSwKICAgIGhhbmRsZVNlbGVjdChlKSB7CiAgICAgIHRoaXMuc2VhcmNoVWlkID0gZS5pZAogICAgfSwKICAgIGhhbmRsZURlbGV0ZU1lbWJlcihzY29wZSkgewogICAgICB2YXIgbWVtYmVycyA9IFtdCiAgICAgIGlmICh0aGlzLnVpZCA9PT0gc2NvcGUucm93LnVpZCkgewogICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICB0aXRsZTogJ+WIoOmZpOWksei0pScsCiAgICAgICAgICBtZXNzYWdlOiAn5peg5rOV5Yig6Zmk6Ieq5bexJywKICAgICAgICAgIHR5cGU6ICdlcnJvcicKICAgICAgICB9KQogICAgICB9CiAgICAgIHRoaXMuZ3JvdXBJbmZvLm1lbWJlcnMuZm9yRWFjaChtID0+IHsKICAgICAgICBpZiAobS51aWQgIT09IHNjb3BlLnJvdy51aWQpIHsKICAgICAgICAgIG1lbWJlcnMucHVzaChtKQogICAgICAgIH0KICAgICAgfSkKICAgICAgdGhpcy5ncm91cEluZm8ubWVtYmVycyA9IG1lbWJlcnMKICAgICAgdGhpcy51cGRhdGVHcm91cEluZm8oJ+S/neWtmOaIkOWKnycsICfliKDpmaTmiJDlkZjvvJonK3Njb3BlLnJvdy51c2VyTmFtZSkKICAgIH0sCiAgICB1cGRhdGVHcm91cEluZm8oc3VjY1RpdGxlLCBzdXNzTXNnKSB7CiAgICAgIGdyb3VwVXBkYXRlKHtpZDogdGhpcy5ncm91cEluZm8uZ2lkLCBncm91cEluZm86IHRoaXMuZ3JvdXBJbmZvfSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmNvZGUgIT09IDApIHsKICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgIHRpdGxlOiAn5L+d5a2Y5aSx6LSlJywKICAgICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiByZXNwb25zZS5kYXRhLm1zZywKICAgICAgICAgICAgdHlwZTogJ2Vycm9yJwogICAgICAgICAgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICAgICAgdGl0bGU6IHN1Y2NUaXRsZSwKICAgICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiBzdXNzTXNnLAogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgICAgIH0pCiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZ3JvdXBJbmZvJywgSlNPTi5zdHJpbmdpZnkodGhpcy5ncm91cEluZm8pKQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICBxdWVyeVNlYXJjaEFzeW5jKHF1ZXJ5U3RyaW5nLCBjYikgewogICAgICB2YXIgcmVzdWx0cyA9IFtdCiAgICAgIHRoaXMuc2VhcmNoVWlkID0gJycKICAgICAgaWYgKHF1ZXJ5U3RyaW5nID09PSAnJykgewogICAgICAgIGNiKHJlc3VsdHMpOwogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIHNlYXJjaFVzZXIoe25hbWU6IHRoaXMuc2VhcmNoVXNlck5hbWV9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS51c2VySW5mb3MgPT09IHVuZGVmaW5lZCB8fCByZXNwb25zZS5kYXRhLnVzZXJJbmZvcyA9PT0gbnVsbCkgewogICAgICAgICAgY2IocmVzdWx0cyk7CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgcmVzcG9uc2UuZGF0YS51c2VySW5mb3MuZm9yRWFjaCh1ID0+IHsKICAgICAgICAgIHJlc3VsdHMucHVzaCh7ICdpZCc6dS51aWQsICd2YWx1ZSc6IHUudXNlck5hbWUgfSkKICAgICAgICB9KQogICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdHMpCiAgICAgICAgY2IocmVzdWx0cyk7CiAgICAgIH0pCiAgICB9LAogIH0KfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4XA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/table","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-tabs type=\"border-card\">\n      <el-tab-pane label=\"配置列表\">\n        <div class=\"operate-box\">\n          <el-button :type=\"groupInfo.IsDev ? 'primary': 'danger'\" @click=\"handleSwitchEnv\">\n            <span v-if=\"groupInfo.IsDev === true\">当前处于测试环境，点击切换到正式环境</span>\n            <span v-else>当前处于正式环境，点击切换到测试环境</span>\n          </el-button>\n          <el-button v-show=\"groupInfo.IsDev\" type=\"primary\" @click=\"handleAddExcel\">添加表格</el-button>\n        </div>\n        <el-table\n          v-loading=\"listLoading\"\n          :data=\"list\"\n          element-loading-text=\"Loading\"\n          border\n          fit\n          highlight-current-row\n          style=\"width: 100%;margin-top:30px;\"\n        >\n          <!-- <el-table-column align=\"center\" label=\"ID\" width=\"210\">\n            <template slot-scope=\"scope\">\n              {{ scope.row.id }}\n            </template>\n          </el-table-column> -->\n          <el-table-column label=\"名称\" width=\"150\">\n            <template slot-scope=\"scope\">\n                <el-link :href=\"'#/config/excel/' + scope.row.name + '/' + scope.row.id\"  type=\"primary\">{{ scope.row.name }}</el-link>\n            </template>\n          </el-table-column>\n          <el-table-column label=\"创建者\"  align=\"center\" width=\"150\">\n            <template slot-scope=\"scope\">\n              <span>{{ scope.row.owner }}</span>\n            </template>\n          </el-table-column>\n          <el-table-column label=\"备注\"  align=\"center\">\n            <template slot-scope=\"scope\">\n              {{ scope.row.remark }}\n            </template>\n          </el-table-column>\n          <el-table-column label=\"创建时间\" width=\"210\" align=\"center\">\n            <template slot-scope=\"scope\">\n              {{ scope.row.createTime | dateFilter }}\n            </template>\n          </el-table-column>\n          <el-table-column label=\"编辑时间\" width=\"210\" align=\"center\">\n            <template slot-scope=\"scope\">\n              {{ scope.row.editTime | dateFilter }}\n            </template>\n          </el-table-column>\n          <el-table-column class-name=\"status-col\" label=\"发布\" width=\"300\" align=\"center\">\n            <template slot-scope=\"scope\">\n              <el-button type=\"success\" size=\"small\" @click=\"handleExport(scope)\">发布</el-button>\n              <el-button type=\"info\" size=\"small\" @click=\"handleExportRecord(scope)\">记录</el-button>\n            </template>\n          </el-table-column>\n          <el-table-column class-name=\"status-col\" label=\"同步正式环境\" width=\"300\" align=\"center\">\n            <template slot-scope=\"scope\">\n              <el-button v-show=\"groupInfo.IsDev\" type=\"warning\" size=\"small\" @click=\"handleExportProd(scope)\">同步正式环境</el-button>\n            </template>\n          </el-table-column>\n          <el-table-column class-name=\"status-col\" label=\"管理\" width=\"300\" align=\"center\">\n            <template slot-scope=\"scope\">\n              <el-button type=\"primary\" size=\"small\" @click=\"handleEdit(scope)\">编辑</el-button>\n              <el-button type=\"danger\" size=\"small\" @click=\"handleDelete(scope)\">删除</el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n\n        <el-dialog :visible.sync=\"dialogVisible\" :title=\"dialogType==='edit'?'编辑Excel信息':'新增Excel'\">\n          <el-form :model=\"excel\" label-width=\"80px\" label-position=\"left\">\n            <el-form-item label=\"名称\">\n              <el-input v-model=\"excel.name\" placeholder=\"名称\" :disabled=\"dialogType==='edit'\" />\n            </el-form-item>\n            <el-form-item label=\"备注\">\n              <el-input\n                v-model=\"excel.remark\"\n                :autosize=\"{ minRows: 2, maxRows: 4}\"\n                type=\"textarea\"\n                placeholder=\"备注\"\n              />\n            </el-form-item>\n            <el-form-item label=\"创建者\" v-show=\"dialogType==='edit'\">\n              <el-input v-model=\"excel.owner\" placeholder=\"创建者\" disabled />\n            </el-form-item>\n          </el-form>\n          <div style=\"text-align:right;\">\n            <el-button type=\"danger\" @click=\"dialogVisible=false\">取消</el-button>\n            <el-button type=\"primary\" @click=\"confirmExcel\">保存</el-button>\n          </div>\n        </el-dialog>\n\n        <el-dialog :visible.sync=\"exportDialogVisible\" title=\"发布表格内容\" width=\"80%\">\n          <div v-loading=\"dialogLoading\">\n            <div style=\"float: left;width: 50%; padding:20px;\">\n              <el-form label-width=\"120px\" label-position=\"left\">\n                <el-form-item label=\"选择表格\">\n                  <el-radio-group v-model=\"sleectedSheet\" @change=\"onSelectedSheetChange(1)\">\n                    <el-radio v-for=\"item in sheetList\" :key=\"item\" :label=\"item\" >{{item}} </el-radio>\n                  </el-radio-group>\n                </el-form-item>\n                <el-form-item label=\"发布内容\">\n                  <el-input\n                    type=\"textarea\"\n                    autosize\n                    placeholder=\"请输入发布内容\"\n                    v-model=\"exportRemark\">\n                  </el-input>\n                </el-form-item>\n                <el-form-item label=\"导出\">\n                  <el-button type=\"primary\" @click=\"exportJsonFile\">导出JSON</el-button>\n                </el-form-item>\n              </el-form>\n            </div>\n            <div style=\"float: left;width: 50%;padding:20px;\">\n              <el-form label-width=\"120px\" label-position=\"left\">\n                <el-form-item label=\"对比设置\">\n                </el-form-item>\n                <el-form-item label=\"差异显示行数\">\n                  <el-input type=\"number\" placeholder=\"10\" v-model.number=\"contextRowLength\"></el-input>\n                </el-form-item>\n              </el-form>\n            </div>\n            <div style=\"width: 100%;text-align: center;clear: both;\">\n              <p style=\"font-size: 18px;font-weight: bold;width: 50%;float: left;\">修改前版本</p>\n              <p style=\"font-size: 18px;font-weight: bold;width: 50%;float: left;\">修改后版本</p>\n            </div>\n            <div style=\"margin-top: 80px;\">\n              <code-diff :old-string=\"codeDiff.beforeExportStr\" :new-string=\"codeDiff.exportStr\" :isShowNoChange=\"true\" :renderNothingWhenEmpty=\"false\" outputFormat=\"side-by-side\"  :context=\"contextRowLength\" />\n            </div>\n          </div>\n          <div style=\"text-align:right;\">\n            <el-button type=\"danger\" @click=\"exportDialogVisible=false\">取消</el-button>\n            <el-button type=\"primary\" @click=\"confirmExport\">发布</el-button>\n          </div>\n        </el-dialog>\n\n        <el-dialog :visible.sync=\"exportProdDialogVisible\" title=\"同步表格内容到正式环境\" width=\"80%\">\n          <div v-loading=\"dialogLoading\">\n            <div style=\"float: left;width: 50%;padding:20px;\">\n              <el-form :model=\"excel\" label-width=\"120px\" label-position=\"left\">\n                <el-form-item label=\"选择表格\">\n                  <el-radio-group v-model=\"sleectedSheet\" @change=\"onSelectedSheetChange(2)\">\n                    <el-radio v-for=\"item in sheetList\" :key=\"item\" :label=\"item\" >{{item}} </el-radio>\n                  </el-radio-group>\n                </el-form-item>\n              </el-form>\n            </div>\n            <div style=\"float: left;width: 50%;padding:20px;\">\n              <el-form label-width=\"120px\" label-position=\"left\">\n                <el-form-item label=\"对比设置\">\n                </el-form-item>\n                <el-form-item label=\"差异显示行数\">\n                  <el-input type=\"number\" placeholder=\"10\" v-model.number=\"contextRowLength\"></el-input>\n                </el-form-item>\n              </el-form>\n            </div>\n            <div style=\"width: 100%;text-align: center;clear: both;\">\n              <p style=\"font-size: 18px;font-weight: bold;width: 50%;float: left;\">正式环境版本</p>\n              <p style=\"font-size: 18px;font-weight: bold;width: 50%;float: left;\">测试环境版本</p>\n            </div>\n            <div style=\"margin-top: 80px;\">\n              <code-diff :old-string=\"codeDiff.beforeExportProdStr\" :new-string=\"codeDiff.exportProdStr\" :isShowNoChange=\"true\" :renderNothingWhenEmpty=\"false\" outputFormat=\"side-by-side\" :context=\"contextRowLength\" />\n            </div>\n          </div>\n          <div style=\"text-align:right;\">\n            <el-button type=\"danger\" @click=\"exportProdDialogVisible=false\">取消</el-button>\n            <el-button type=\"primary\" @click=\"confirmExportProd\">同步</el-button>\n          </div>\n        </el-dialog>\n\n        <el-dialog :visible.sync=\"exportRecordDialogVisible\" title=\"发布记录\" width=\"80%\">\n          <div v-loading=\"dialogLoading\">\n            <div style=\"float: left;width: 50%; padding:20px;\">\n              <el-form :model=\"excel\" label-width=\"120px\" label-position=\"left\">\n                <el-form-item label=\"选择表格\">\n                  <el-radio-group v-model=\"sleectedSheet\" @change=\"onSelectedSheetChange(3)\">\n                    <el-radio v-for=\"item in sheetList\" :key=\"item\" :label=\"item\" >{{item}} </el-radio>\n                  </el-radio-group>\n                </el-form-item>\n                <el-form-item label=\"发布记录\">\n                  <el-select v-model=\"selectRecordId\" @change=\"onSelectRecordChange()\" filterable placeholder=\"选择历史发布记录\" style=\"width:90%;\">\n                    <el-option\n                      v-for=\"item in recordList\"\n                      :key=\"item.id\"\n                      :label=\"item.remark\"\n                      :value=\"item.id\">\n                      <span style=\"float: left;margin-right:100px;\">{{ item.remark }}</span>\n                      <span style=\"float: right; color: #8492a6; font-size: 13px\">{{ item.userName }} 发布于 {{ item.time }}</span>\n                    </el-option>\n                  </el-select>\n                  <el-button style=\"margin-top: 20px;\" type=\"danger\" @click=\"handleRollBack\">回退到此版本</el-button>\n                </el-form-item>\n              </el-form>\n            </div>\n            <div style=\"float: left;width: 50%;padding:20px;\">\n              <el-form label-width=\"120px\" label-position=\"left\">\n                <el-form-item label=\"对比设置\">\n                </el-form-item>\n                <el-form-item label=\"差异显示行数\">\n                  <el-input type=\"number\" placeholder=\"10\" v-model.number=\"contextRowLength\"></el-input>\n                </el-form-item>\n              </el-form>\n            </div>\n            <div style=\"width: 100%;text-align: center; clear: both;\">\n              <p style=\"font-size: 18px;font-weight: bold;width: 50%;float: left;\">发布前版本</p>\n              <p style=\"font-size: 18px;font-weight: bold;width: 50%;float: left;\">发布后版本</p>\n            </div>\n            <div style=\"margin-top: 80px;\">\n              <code-diff :old-string=\"codeDiff.beforeExportRecordStr\" :new-string=\"codeDiff.exportRecordStr\" :isShowNoChange=\"true\" :renderNothingWhenEmpty=\"false\" outputFormat=\"side-by-side\" :context=\"contextRowLength\" />\n            </div>\n          </div>\n        </el-dialog>\n\n      </el-tab-pane>\n\n\n      <el-tab-pane label=\"项目配置\">\n        <el-form ref=\"form\" :model=\"groupInfo\" label-width=\"120px\">\n          <el-form-item label=\"名称\">\n            <el-input v-model=\"groupInfo.name\" value=\"贪吃蛇大作战\" />\n          </el-form-item>\n          <el-form-item label=\"头像\">\n            <el-col :span=\"11\">\n              <img id=\"group-icon\" v-bind:src=\"groupInfo.avatar\" alt=\"\">\n              <input class=\"avatar-input\" type=\"file\" accept=\"image/*\" @change=\"uploadAvatar\" name=\"avatar\"   />\n            </el-col>\n          </el-form-item>\n          <br>\n          <el-form-item label=\"备注\">\n            <el-input v-model=\"groupInfo.remark\" type=\"textarea\" />\n          </el-form-item>\n          <el-form-item label=\"授权访问Token\">\n            <div class=\"el-col-8\">\n              <el-input v-model=\"groupInfo.AccessToken\" type=\"text\" />\n            </div>\n            <div class=\"el-col-4\" style=\"margin-left: 20px;\">\n              <el-button type=\"primary\" @click=\"generateAccessToken\">刷新AccessToken</el-button>\n            </div>\n            <br>\n            <el-tag type=\"danger\" >\n              外部应用可以通过授权访问token调用Api获取Excel内容，具体内容请参见API文档描述\n            </el-tag>\n          </el-form-item>\n          <el-form-item label=\"数据仓库\">\n            <el-checkbox-group v-model=\"groupInfo.store\" style=\"padding: 5px 15px;\">\n              <el-checkbox v-for=\"item in storeOptions\" :key=\"item.key\" :label=\"item.key\">\n                {{ item.name }}\n              </el-checkbox>\n            </el-checkbox-group>\n          </el-form-item>\n          <el-form-item v-show=\"inArray(groupInfo.store, 1)\" label=\"Redis配置\" class=\"store-group\">\n            <el-form-item label=\"RedisDSN\">\n              <el-input v-model=\"groupInfo.RedisDSN\" name=\"RedisDSN\" type=\"text\" placeholder=\"172.2.1.88:6379\" />\n            </el-form-item>\n            <el-form-item label=\"密码\">\n              <el-input v-model=\"groupInfo.RedisPassword\" name=\"RedisPassword\" auto-complete=\"new-password\" type=\"password\" placeholder=\"password\" />\n            </el-form-item>\n            <el-form-item label=\"KeyPrefix\">\n              <el-input v-model=\"groupInfo.RedisKeyPrefix\" type=\"text\" placeholder=\"key prefix 可不填\" />\n            </el-form-item>\n            <el-tag type=\"danger\" style=\"margin-left: 40px;\" >\n              应用可以通过订阅redis的channel：{{groupInfo.RedisKeyPrefix}}config_refresh 获取配置更新的通知，message为更新的表名\n            </el-tag>\n            <el-form-item label=\" \">\n              <el-button type=\"success\" @click=\"testRedisConnection\">测试连通性</el-button>\n            </el-form-item>\n          </el-form-item>\n\n          <el-form-item v-show=\"inArray(groupInfo.store, 2)\" label=\"Mysql配置\" class=\"store-group\">\n            <el-form-item label=\"MysqlDSN\">\n              <el-input v-model=\"groupInfo.MysqlDSN\" type=\"text\" placeholder=\"username:password@tcp(172.2.1.88:3306)/dbname?charset=utf8mb4\" />\n            </el-form-item>\n            <el-form-item label=\" \">\n              <el-button type=\"success\" @click=\"testMysqlConnection\">测试连通性</el-button>\n            </el-form-item>\n          </el-form-item>\n\n          <el-form-item v-show=\"inArray(groupInfo.store, 3)\" label=\"Mongodb配置\" class=\"store-group\">\n            <el-form-item label=\"MongodbDSN\">\n              <el-input v-model=\"groupInfo.MongodbDSN\" type=\"text\" placeholder=\"mongodb://username:password@127.0.0.1:27017/?authSource=dbname\" />\n            </el-form-item>\n            <el-form-item label=\" \">\n              <el-button type=\"success\" @click=\"testMongodbConnection\">测试连通性</el-button>\n            </el-form-item>\n          </el-form-item>\n\n          <el-form-item v-show=\"inArray(groupInfo.store, 4)\" label=\"Databus配置\" class=\"store-group\">\n            <el-form-item label=\"GrpcDSN\">\n              <el-input v-model=\"groupInfo.GrpcDSN\" name=\"GrpcDSN\" type=\"text\" placeholder=\"172.2.1.88:10000\" />\n            </el-form-item>\n            <el-form-item label=\"GrpcAppKey\">\n              <el-input v-model=\"groupInfo.GrpcAppKey\" name=\"GrpcAppKey\" type=\"text\" placeholder=\"appKey\" />\n            </el-form-item>\n            <el-form-item label=\"GrpcAppSecret\">\n              <el-input v-model=\"groupInfo.GrpcAppSecret\" name=\"GrpcAppSecret\" type=\"text\" placeholder=\"appSecret\" />\n            </el-form-item>\n            <el-tag type=\"danger\" style=\"margin-left: 40px;\" >\n              请参阅Readme.md文档搭建e2cdatabus服务器\n            </el-tag>\n            <el-form-item label=\" \">\n              <el-button type=\"primary\" @click=\"generateAppKeySecretHandler\">获取AppKey和AppSecret</el-button>\n              <el-button type=\"success\" @click=\"testGRpcConnection\">测试连通性</el-button>\n            </el-form-item>\n          </el-form-item>\n\n          <el-form-item>\n            <el-button type=\"primary\" @click=\"saveGroupConfig\">保存</el-button>\n          </el-form-item>\n        </el-form>\n      </el-tab-pane>\n      <el-tab-pane label=\"项目成员\">\n        <el-button type=\"primary\" @click=\"handleAddMember\">添加成员</el-button>\n        <el-table\n          v-loading=\"listLoading\"\n          :data=\"groupInfo.members\"\n          element-loading-text=\"Loading\"\n          border\n          fit\n          highlight-current-row\n          style=\"width: 100%;margin-top:30px;\"\n        >\n        <!-- <el-table-column label=\"头像\"  align=\"center\" >\n            <template slot-scope=\"scope\">\n              <img :src=\"scope.row.avatar\" style=\"width:60px;border-radius:50%;\" alt=\"\">\n            </template>\n          </el-table-column> -->\n          <el-table-column label=\"昵称\"  align=\"center\" >\n            <template slot-scope=\"scope\">\n              <span>{{ scope.row.userName }}</span>\n            </template>\n          </el-table-column>\n\n          <el-table-column label=\"角色\"  align=\"center\" >\n            <template slot-scope=\"scope\">\n              <el-select v-show=\"uid !== scope.row.uid\" v-model.number=\"scope.row.role\" @change=\"onChangeUserRole(scope)\" placeholder=\"用户角色\" style=\"width:90%;\">\n                <el-option\n                  v-for=\"item in roleNames\"\n                  :key=\"item.role\"\n                  :label=\"item.name\"\n                  :value=\"item.role\">\n                </el-option>\n              </el-select>\n              <span v-show=\"uid === scope.row.uid\">{{ scope.row.role | roleFilter }}</span>\n            </template>\n          </el-table-column>\n\n          <el-table-column class-name=\"status-col\" label=\"操作\" width=\"300\" align=\"center\">\n            <template slot-scope=\"scope\">\n              <el-button v-show=\"showDeleteBtn(scope)\" type=\"danger\" size=\"small\" @click=\"handleDeleteMember(scope)\">删除</el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n\n        <el-dialog :visible.sync=\"addMemberdialogVisible\" title=\"添加成员\" width=\"500px\">\n          <el-form label-width=\"80px\" label-position=\"left\">\n            <el-form-item label=\"名称\">\n              <el-autocomplete\n                v-model=\"searchUserName\"\n                :fetch-suggestions=\"querySearchAsync\"\n                placeholder=\"请输入名称:\"\n                clearable\n                :trigger-on-focus=\"false\"\n                @select=\"handleSelect\"\n              ></el-autocomplete>\n            </el-form-item>\n          </el-form>\n          <br>\n          <div style=\"text-align:right;\">\n            <el-button type=\"danger\" @click=\"addMemberdialogVisible=false\">取消</el-button>\n            <el-button type=\"primary\" @click=\"addMember()\">保存</el-button>\n          </div>\n        </el-dialog>\n      </el-tab-pane>\n    </el-tabs>\n\n  </div>\n</template>\n\n<script>\nimport { getList, deleteExcel, updateExcel, addExcel, exportExcel, getSheetList, exportExcelProd } from '@/api/sheet'\nimport { searchUser } from '@/api/user'\nimport { groupUpdate, groupTestConnection, getConfigFromDB, exportConfigToDB, generateAppKeySecret,\n  groupList, syncToProd, exportRecord, exportRecordContent, exportRollback } from '@/api/group'\nimport { mapGetters } from 'vuex'\nimport { deepClone } from '@/utils'\nimport CodeDiff from 'vue-code-diff'\nimport { MessageBox } from 'element-ui'\n\nconst defaultExcel = {\n  id: '',\n  name: '',\n  owner: '',\n  remark: '',\n  create_time: '',\n  update_time: ''\n}\n\nconst Role = {\n  Admin: 1,\n  Developer: 2\n}\nconst roleConfig = [\n  { 'role': 1, 'name': '管理员' },\n  { 'role': 2, 'name': '开发者' }\n]\n\nexport default {\n  components: { CodeDiff },\n  computed: {\n    ...mapGetters([\n      'uid',\n      'name'\n    ])\n  },\n  filters: {\n    statusFilter(status) {\n      const statusMap = {\n        published: 'success',\n        draft: 'gray',\n        deleted: 'danger'\n      }\n      return statusMap[status]\n    },\n    dateFilter(datetime) {\n      return new Date(parseInt(datetime) * 1000).toLocaleString().replace(/:\\d{1,2}$/,' ');\n    },\n    roleFilter(role) {\n      if (role === undefined || role === null) {\n        role = Role.Developer\n      }\n      if (roleConfig.length >= role) {\n        return roleConfig[ role - 1 ].name\n      }\n      return '未定义'\n    }\n  },\n  data() {\n    return {\n      excel: Object.assign({}, defaultExcel),\n      list: [],\n      listLoading: true,\n      dialogLoading: false,\n      dialogVisible: false,\n      dialogType: 'new',\n      exportDialogVisible: false,\n      exportFormat: '',\n      form: {},\n      groupInfo: {\n        name: '贪吃蛇大作战',\n        remark: '这是贪吃蛇大作战App项目',\n        avatar: require('../../icons/tanchishe-icon.png'),\n        store: []\n      },\n      storeOptions: [\n        { key: 1, name: 'Redis' },\n        { key: 2, name: 'Mysql' },\n        // {key: 'Mongodb', name: 'Mongodb'},\n        { key: 4, name: 'Databus' }\n      ],\n      addMemberdialogVisible: false,\n      searchUserName: '',\n      searchUid: '',\n      compareVisable: false,\n      sheetList: [],\n      sleectedSheet: '',\n      exportProdDialogVisible: false,\n      exportRecordDialogVisible: false,\n      selectRecordId: '',\n      recordList: [],\n      exportRemark: '',\n      contextRowLength: 10,\n      codeDiff: {\n        beforeExportStr: '',\n        exportStr: '',\n        beforeExportProdStr: '',\n        exportProdStr: '',\n        beforeExportRecordStr: '',\n        exportRecordStr: ''\n      },\n      roleNames: roleConfig\n    }\n  },\n  created() {\n    this.excel.owner = this.name\n    this.fetchData()\n  },\n  methods: {\n    fetchData() {\n      this.listLoading = true\n      var groupInfo = localStorage.getItem('groupInfo')\n      groupInfo = JSON.parse(groupInfo)\n      console.log(groupInfo)\n      if (groupInfo === null) {\n        this.$router.push({\n          path: '/'\n        })\n        return\n      }\n      if (groupInfo.store === undefined || groupInfo.store === null) {\n        groupInfo.store = []\n      }\n      this.groupInfo = groupInfo\n      this.groupInfo.members.forEach(m => {\n        if (m.uid === this.uid && (m.role === 0 || m.role === undefined)) {\n          m.role = Role.Admin\n        }\n      })\n      getList({limit: 10, group_id: groupInfo.gid}).then(response => {\n        if (response.data.list !== undefined) {\n          this.list = response.data.list\n        }\n        this.listLoading = false\n      })\n    },\n    handleAddExcel() {\n      this.excel = Object.assign({}, defaultExcel),\n      this.excel.owner = this.name\n      this.dialogType = 'new'\n      this.dialogVisible = true\n    },\n    handleSwitchEnv() {\n      var text = '当前处于正式环境，是否确认切换到测试环境'\n      if (this.groupInfo.IsDev) {\n        text = '当前处于测试环境，是否确认切换到正式环境'\n      }\n      MessageBox.confirm(text, '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(res => {\n        if (res === undefined) {\n          return\n        }\n        var unionGid = this.groupInfo.UnionGroupId\n        groupList(unionGid).then(response => {\n          if (response.data.list !== undefined && response.data.list.length > 0) {\n            this.groupInfo = response.data.list[0]\n            localStorage.setItem('groupInfo', JSON.stringify(this.groupInfo))\n            // refresh\n            var path = this.$route.path\n            this.$router.push({\n              path,\n              query: {\n                t: +new Date() //保证每次点击路由的query项都是不一样的，确保会重新刷新view\n              }\n            })\n            this.fetchData()\n          } else{\n            this.$message({\n              type: 'warning',\n              message: '暂无权限，请联系管理员添加权限'\n            })\n          }\n        })\n      }).catch(e => {\n        console.log(e)\n      })\n    },\n    async confirmExcel() {\n      if (this.excel.name.length === 0) {\n        this.$message({\n          type: 'warning',\n          message: '请输入名称'\n        })\n        return\n      }\n      const isEdit = this.dialogType === 'edit'\n      if (isEdit) {\n        await updateExcel(this.excel)\n        for (let index = 0; index < this.list.length; index++) {\n          if (this.list[index].id === this.excel.id) {\n            this.list.splice(index, 1, Object.assign({}, this.excel))\n            break\n          }\n        }\n      } else {\n        var params = this.excel\n        params.uid = this.uid\n        params.group_id = this.groupInfo.gid\n        const { data } = await addExcel(params)\n        this.excel.id = data.eid\n        var timestamp=new Date().getTime()\n        this.excel.createTime = timestamp/1000\n        this.excel.editTime = timestamp/1000\n        this.list.push(this.excel)\n      }\n\n      const { id, name, remark } = this.excel\n      this.dialogVisible = false\n      this.$notify({\n        title: 'Success',\n        dangerouslyUseHTMLString: true,\n        message: `\n            <div>名称: ${name}</div>\n            <div>备注: ${remark}</div>\n          `,\n        type: 'success'\n      })\n    },\n    handleEdit(scope) {\n      this.dialogType = 'edit'\n      this.dialogVisible = true\n      this.checkStrictly = true\n      this.excel = deepClone(scope.row)\n    },\n    handleDelete({$index, row}) {\n      this.$confirm('确定删除表格吗?', 'Warning', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async() => {\n        await deleteExcel({id: row.id, name: row.name})\n        this.list.splice($index, 1)\n        this.$message({\n          type: 'success',\n          message: '删除成功!'\n        })\n      }).catch(err => { console.error(err) })\n    },\n    handleExport(scope) {\n      this.excel = deepClone(scope.row)\n      this.exportDialogVisible = true\n      this.sheetList = []\n      this.codeDiff.beforeExportStr = ''\n      this.codeDiff.exportStr = ''\n      this.exportRemark = ''\n      this.dialogLoading = true\n      getSheetList({gridKey: this.excel.id}).then(response => {\n        if (response.code === 0) {\n          this.sheetList = response.data.sheetName\n          console.log(this.sheetList)\n          if (this.sheetList.length > 0) {\n            this.sleectedSheet = this.sheetList[0]\n          }\n          this.getExcelSheetContent(this.excel.id, this.sleectedSheet)\n          this.getExcelSheetFromDB(this.excel.id, this.sleectedSheet)\n        }\n      })\n    },\n    handleExportProd(scope) {\n      this.excel = deepClone(scope.row)\n      this.exportProdDialogVisible = true\n      this.sheetList = []\n      this.codeDiff.beforeExportProdStr = ''\n      this.codeDiff.exportProdStr = ''\n      this.dialogLoading = true\n      getSheetList({gridKey: this.excel.id}).then(response => {\n        if (response.code === 0) {\n          this.sheetList = response.data.sheetName\n          console.log(this.sheetList)\n          if (this.sheetList.length > 0) {\n            this.sleectedSheet = this.sheetList[0]\n          }\n          this.getExcelSheetContent(this.excel.id, this.sleectedSheet)\n          this.getExcelSheetFromProd(this.excel.id, this.sleectedSheet)\n        }\n      })\n    },\n    handleExportRecord(scope) {\n      this.excel = deepClone(scope.row)\n      this.exportRecordDialogVisible = true\n      this.sheetList = []\n      this.exportRecord = []\n      this.codeDiff.beforeExportRecordStr = ''\n      this.codeDiff.exportRecordStr = ''\n      this.dialogLoading = true\n      getSheetList({gridKey: this.excel.id}).then(response => {\n        if (response.code === 0) {\n          this.sheetList = response.data.sheetName\n          console.log(this.sheetList)\n          if (this.sheetList.length > 0) {\n            this.sleectedSheet = this.sheetList[0]\n          }\n          // 获取record list\n          this.getRecordList()\n        }\n      })\n    },\n    getRecordList() {\n      exportRecord({gridKey: this.excel.id, sheetName: this.sleectedSheet}).then(resp => {\n        if (resp.data !== null) {\n          this.recordList = resp.data.list\n        }\n        if (this.recordList.length > 0) {\n          this.selectRecordId = this.recordList[0].id\n        }\n        this.refreshRecordContent()\n      })\n    },\n    refreshRecordContent() {\n      var lastRecordId = ''\n      // 判断是否有上一个record\n      for (var i=0;i<this.recordList.length;i++) {\n        if (this.recordList[i].id === this.selectRecordId) {\n          if (i+1<this.recordList.length) {\n            console.log('record：', this.recordList[i+1])\n            lastRecordId = this.recordList[i+1].id\n          }\n        }\n      }\n      this.getExcelSheetFromRecord(this.excel.id, this.sleectedSheet, this.selectRecordId)\n      this.getExcelSheetFromRecord(this.excel.id, this.sleectedSheet, lastRecordId)\n    },\n    async getExcelSheetContent(gridKey, sheetName) {\n      this.codeDiff.exportStr = ''\n      var params = {}\n      params.gridKey = gridKey\n      params.sheetName = sheetName\n      params.format = 'json'\n      const { data } = await exportExcel(params)\n      if (data.jsonstr !== undefined && data.jsonstr.length > 0) {\n        this.codeDiff.exportStr = data.jsonstr\n        this.codeDiff.exportProdStr = data.jsonstr\n        this.dialogLoading = false\n      }\n    },\n    async getExcelSheetFromDB(gridKey, sheetName) {\n      this.codeDiff.beforeExportStr = ''\n      var params = {}\n      params.gridKey = gridKey\n      params.sheetName = sheetName\n      const { data } = await getConfigFromDB(params)\n      if (data.jsonstr !== undefined && data.jsonstr.length > 0) {\n        this.codeDiff.beforeExportStr = data.jsonstr\n        this.dialogLoading = false\n      }\n    },\n    async getExcelSheetFromProd(gridKey, sheetName) {\n      this.codeDiff.beforeExportProdStr = ''\n      var params = {}\n      params.gridKey = gridKey\n      params.sheetName = sheetName\n      params.format = 'json'\n      params.gid = this.groupInfo.gid\n      const { data } = await exportExcelProd(params)\n      if (data.jsonstr !== undefined && data.jsonstr.length > 0) {\n        this.codeDiff.beforeExportProdStr = data.jsonstr\n        this.dialogLoading = false\n      }\n    },\n    async getExcelSheetFromRecord(gridKey, sheetName, recordId) {\n      if (recordId === this.selectRecordId) {\n        this.codeDiff.exportRecordStr = ''\n      } else {\n        this.codeDiff.beforeExportRecordStr = ''\n      }\n      if (recordId.length === 0) {\n        return\n      }\n      var params = {}\n      params.gridKey = gridKey\n      params.sheetName = sheetName\n      params.recordId = recordId\n      params.format = 'json'\n      const { data } = await exportRecordContent(params)\n      if (data.jsonstr !== undefined && data.jsonstr.length > 0) {\n        if (recordId === this.selectRecordId) {\n          this.codeDiff.exportRecordStr = data.jsonstr\n          this.dialogLoading = false\n        } else {\n          this.codeDiff.beforeExportRecordStr = data.jsonstr\n          this.dialogLoading = false\n        }\n      }\n    },\n    handleRollBack() {\n      var text = '您当前选择的配置表是 \\\"' + this.sleectedSheet + '\\\", 确认要回退版本吗？'\n      MessageBox.confirm(text, '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(res => {\n        if (res === undefined) {\n          return\n        }\n        var params = {}\n        params.gridKey = this.excel.id\n        params.sheetName = this.sleectedSheet\n        params.recordId = this.selectRecordId\n        exportRollback(params).then(response => {\n          if (response.code !== 0) {\n              this.$notify({\n                title: '回退失败',\n                dangerouslyUseHTMLString: true,\n                message: response.data.msg,\n                type: 'error'\n              })\n            } else {\n              this.$notify({\n                title: '回退成功',\n                dangerouslyUseHTMLString: true,\n                message: '',\n                type: 'success'\n              })\n              this.exportRecordDialogVisible = false\n            }\n          }\n        )\n      }).catch(e => {\n        console.log(e)\n      })\n    },\n    onSelectedSheetChange(e) {\n      this.dialogLoading = true\n      if (e === 1) { // 发布弹窗\n        this.listLoading = true\n        this.getExcelSheetContent(this.excel.id, this.sleectedSheet)\n        this.getExcelSheetFromDB(this.excel.id, this.sleectedSheet)\n        this.listLoading = false\n      } else if (e === 2) { // 同步弹窗\n        this.getExcelSheetContent(this.excel.id, this.sleectedSheet)\n        this.getExcelSheetFromProd(this.excel.id, this.sleectedSheet)\n      } else if (e === 3) { //发布记录弹窗\n        this.selectRecordId = ''\n        this.codeDiff.beforeExportRecordStr = ''\n        this.codeDiff.exportRecordStr = ''\n        this.recordList = []\n        this.getRecordList()\n      }\n    },\n    onSelectRecordChange(e) {\n      console.log('select record changed')\n      this.refreshRecordContent()\n    },\n    confirmExport() {\n      if (this.exportRemark.length === 0) {\n        this.$notify({\n          title: '发布失败',\n          dangerouslyUseHTMLString: true,\n          message: '请填写发布内容',\n          type: 'error'\n        })\n        return\n      }\n      var text = '您当前选择的配置表是 \\\"' + this.sleectedSheet + '\\\", 修改备注为 \\\"'+this.exportRemark + '\\\", 确认发布吗？'\n      if (!this.groupInfo.IsDev) {\n        text = '当前处于正式环境, ' + text\n      }\n      MessageBox.confirm(text, '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(res => {\n        var params = {}\n        params.gridKey = this.excel.id\n        params.sheetName = this.sleectedSheet\n        params.remark = this.exportRemark\n        exportConfigToDB(params).then(response => {\n          if (response.code === 0) {\n            if (response.code !== 0) {\n              this.$notify({\n                title: '发布失败',\n                dangerouslyUseHTMLString: true,\n                message: response.data.msg,\n                type: 'error'\n              })\n            } else {\n              this.$notify({\n                title: '发布成功',\n                dangerouslyUseHTMLString: true,\n                message: '',\n                type: 'success'\n              })\n              this.exportDialogVisible = false\n            }\n          }\n        })\n      })\n    },\n    confirmExportProd() {\n      var params = {}\n      params.gridKey = this.excel.id\n      params.sheetName = this.sleectedSheet\n      params.gid = this.groupInfo.gid\n      syncToProd(params).then(response => {\n        if (response.code === 0) {\n          if (response.code !== 0) {\n            this.$notify({\n              title: '同步失败',\n              dangerouslyUseHTMLString: true,\n              message: response.data.msg,\n              type: 'error'\n            })\n          } else {\n            this.$notify({\n              title: '同步成功',\n              dangerouslyUseHTMLString: true,\n              message: '',\n              type: 'success'\n            })\n            this.exportProdDialogVisible = false\n          }\n        }\n      })\n    },\n    exportJsonFile() {\n      this.downloadJsonFile(this.codeDiff.beforeExportStr, this.sleectedSheet + '.json')\n    },\n    downloadJsonFile(content, filename) {\n      var eleLink = document.createElement('a')\n      eleLink.download = filename\n      eleLink.style.display = 'none'\n      // 字符内容转变成blob地址\n      var blob = new Blob([content])\n      eleLink.href = URL.createObjectURL(blob)\n      // 触发点击\n      document.body.appendChild(eleLink)\n      eleLink.click()\n      // 然后移除\n      document.body.removeChild(eleLink)\n    },\n    saveGroupConfig() {\n      groupUpdate({id: this.groupInfo.gid, groupInfo: this.groupInfo}).then(response => {\n        if (response.code !== 0) {\n          this.$notify({\n            title: '保存失败',\n            dangerouslyUseHTMLString: true,\n            message: response.data.msg,\n            type: 'error'\n          })\n        } else {\n          this.$notify({\n            title: '保存成功',\n            dangerouslyUseHTMLString: true,\n            message: '',\n            type: 'success'\n          })\n          localStorage.setItem('groupInfo', JSON.stringify(this.groupInfo))\n        }\n      })\n    },\n    uploadAvatar(e) {\n      e.preventDefault()\n      console.log(e)\n      const files = e.target.files || e.dataTransfer.files\n      if (this.checkFile(files[0])) {\n        this.setSourceImg(files[0])\n      }\n    },\n    /* ---------------------------------------------------------------*/\n    // 检测选择的文件是否合适\n    checkFile(file) {\n      const { lang, maxSize } = this\n      // 仅限图片\n      if (file.type.indexOf('image') === -1) {\n        this.hasError = true\n        this.errorMsg = lang.error.onlyImg\n        return false\n      }\n      // 超出大小\n      if (file.size / 1024 > maxSize) {\n        this.hasError = true\n        this.errorMsg = lang.error.outOfSize + maxSize + 'kb'\n        return false\n      }\n      return true\n    },\n    setSourceImg(file) {\n      const fr = new FileReader()\n      fr.onload = e => {\n        this.groupInfo.avatar = fr.result\n      }\n      fr.readAsDataURL(file)\n    },\n    inArray(arr, target) {\n      for (var i in arr) {\n        if (arr[i] === target) {\n          return true\n        }\n      }\n      return false\n    },\n    testRedisConnection(e) {\n      var params = {dsnType:1,dsn:this.groupInfo.RedisDSN,pwd:this.groupInfo.RedisPassword}\n      groupTestConnection(params).then(response => {\n        if (response.data.connected === 0 || response.data.connected === undefined) {\n          this.$notify({\n            title: 'Redis连接失败',\n            dangerouslyUseHTMLString: true,\n            message: `请检查DSN配置或者IP白名单配置`,\n            type: 'error'\n          })\n          return\n        } else {\n          this.$notify({\n            title: 'Redis连接成功',\n            dangerouslyUseHTMLString: true,\n            message: ``,\n            type: 'success'\n          })\n        }\n      })\n    },\n    testMysqlConnection() {\n      var params = {dsnType:2,dsn:this.groupInfo.MysqlDSN}\n      groupTestConnection(params).then(response => {\n        if (response.data.connected === 0 || response.data.connected === undefined) {\n          this.$notify({\n            title: 'Mysql连接失败',\n            dangerouslyUseHTMLString: true,\n            message: `请检查DSN配置或者IP白名单配置`,\n            type: 'error'\n          })\n          return\n        } else {\n          this.$notify({\n            title: 'Mysql连接成功',\n            dangerouslyUseHTMLString: true,\n            message: ``,\n            type: 'success'\n          })\n        }\n      })\n    },\n    testGRpcConnection() {\n      var params = {\n        dsnType: 4,\n        dsn:    this.groupInfo.GrpcDSN,\n        appKey: this.groupInfo.GrpcAppKey,\n        appSecret: this.groupInfo.GrpcAppSecret,\n      }\n      groupTestConnection(params).then(response => {\n        if (response.data.connected === 0 || response.data.connected === undefined) {\n          this.$notify({\n            title: 'Databus连接失败',\n            dangerouslyUseHTMLString: true,\n            message: `请启动Databus服务，检查DSN和AppKey、AppSecret配置`,\n            type: 'error'\n          })\n          return\n        } else {\n          this.$notify({\n            title: 'Databus连接成功',\n            dangerouslyUseHTMLString: true,\n            message: ``,\n            type: 'success'\n          })\n        }\n      })\n    },\n    generateAppKeySecretHandler() {\n      this.$set(this.groupInfo, 'GrpcDSN', '')\n      generateAppKeySecret().then(response => {\n        if (response.data === null || response.data.appKey === '' || response.data.appSecret === '') {\n          this.$notify({\n            title: '获取失败',\n            dangerouslyUseHTMLString: true,\n            message: `请联系管理员`,\n            type: 'error'\n          })\n          return\n        } else {\n          this.$notify({\n            title: '获取成功',\n            dangerouslyUseHTMLString: true,\n            message: `请参阅文档搭建e2cdatabus服务器`,\n            type: 'success'\n          })\n          this.$set(this.groupInfo, 'GrpcAppKey', response.data.appKey)\n          this.$set(this.groupInfo, 'GrpcAppSecret', response.data.appSecret)\n        }\n      })\n    },\n    generateAccessToken() {\n      this.$set(this.groupInfo, 'AccessToken', '')\n      generateAppKeySecret().then(response => {\n        if (response.data === null || response.data.appKey === '' || response.data.appSecret === '') {\n          this.$notify({\n            title: '获取失败',\n            dangerouslyUseHTMLString: true,\n            message: `请联系管理员`,\n            type: 'error'\n          })\n          return\n        } else {\n          this.$notify({\n            title: '刷新成功',\n            dangerouslyUseHTMLString: true,\n            message: `保存后即可生效`,\n            type: 'success'\n          })\n          this.$set(this.groupInfo, 'AccessToken', response.data.appSecret)\n        }\n      })\n    },\n    testMongodbConnection() {\n      var params = { dsnType: 3, dsn: this.groupInfo.MongodbDSN }\n      groupTestConnection(params).then(response => {\n        if (response.data.connected === 0 || response.data.connected === undefined) {\n          this.$notify({\n            title: 'Mongodb连接失败',\n            dangerouslyUseHTMLString: true,\n            message: `请检查DSN配置或者IP白名单配置`,\n            type: 'error'\n          })\n          return\n        } else {\n          this.$notify({\n            title: 'Mongodb连接成功',\n            dangerouslyUseHTMLString: true,\n            message: ``,\n            type: 'success'\n          })\n        }\n      })\n    },\n    showDeleteBtn(scope) {\n      if (this.uid === scope.row.uid) {\n        return false\n      }\n      let isAdmin = false\n      this.groupInfo.members.forEach(m => {\n        if (m.uid === this.uid) {\n          isAdmin = m.role === Role.Admin\n        }\n      })\n      return isAdmin\n    },\n    handleAddMember() {\n      this.addMemberdialogVisible = true\n    },\n    addMember() {\n      var exist = false\n      this.groupInfo.members.forEach(m => {\n        if (m.uid === this.searchUid) {\n          exist = true\n          return\n        }\n      })\n      if (exist) {\n        this.$notify({\n          title: '添加失败',\n          dangerouslyUseHTMLString: true,\n          message: `成员已存在`,\n          type: 'error'\n        })\n        return\n      }\n      this.groupInfo.members.push({\n        uid: this.searchUid,\n        userName: this.searchUserName,\n        role: Role.Developer\n      })\n      this.updateGroupInfo('保存成功', '添加成员：'+this.searchUserName)\n      this.addMemberdialogVisible = false\n    },\n    onChangeUserRole(scope) {\n      var role = scope.row.role\n      this.groupInfo.members.forEach(m => {\n        if (m.uid === this.searchUid) {\n          if (m.role === role) {\n            return\n          }\n          m.role = role\n        }\n      })\n      this.updateGroupInfo('保存成功', '修改' + scope.row.userName + '为：' + this.roleNames[role - 1].name)\n    },\n    handleSelect(e) {\n      this.searchUid = e.id\n    },\n    handleDeleteMember(scope) {\n      var members = []\n      if (this.uid === scope.row.uid) {\n        this.$notify({\n          title: '删除失败',\n          message: '无法删除自己',\n          type: 'error'\n        })\n      }\n      this.groupInfo.members.forEach(m => {\n        if (m.uid !== scope.row.uid) {\n          members.push(m)\n        }\n      })\n      this.groupInfo.members = members\n      this.updateGroupInfo('保存成功', '删除成员：'+scope.row.userName)\n    },\n    updateGroupInfo(succTitle, sussMsg) {\n      groupUpdate({id: this.groupInfo.gid, groupInfo: this.groupInfo}).then(response => {\n        if (response.code !== 0) {\n          this.$notify({\n            title: '保存失败',\n            dangerouslyUseHTMLString: true,\n            message: response.data.msg,\n            type: 'error'\n          })\n        } else {\n          this.$notify({\n            title: succTitle,\n            dangerouslyUseHTMLString: true,\n            message: sussMsg,\n            type: 'success'\n          })\n          localStorage.setItem('groupInfo', JSON.stringify(this.groupInfo))\n        }\n      })\n    },\n    querySearchAsync(queryString, cb) {\n      var results = []\n      this.searchUid = ''\n      if (queryString === '') {\n        cb(results);\n        return\n      }\n      searchUser({name: this.searchUserName}).then(response => {\n        if (response.data.userInfos === undefined || response.data.userInfos === null) {\n          cb(results);\n          return\n        }\n        response.data.userInfos.forEach(u => {\n          results.push({ 'id':u.uid, 'value': u.userName })\n        })\n        console.log(results)\n        cb(results);\n      })\n    },\n  }\n}\n</script>\n\n<style scoped>\n  .avatar-input {\n    float: left;\n    position: absolute;\n    height: 60px;\n    width: 60px;\n    opacity: 0;\n  }\n  #group-icon {\n    float: left;\n    width: 60px;\n    height: 60px;\n    border-radius: 50%;\n    position: absolute;\n  }\n  .store-group {\n    border: 1px solid #DCDFE6;\n    border-radius: 5px;\n    padding: 10px;\n  }\n  .store-group .el-form-item {\n    margin: 10px auto;\n  }\n  .group-title {\n    text-align: center;\n    font-size: 24px;\n    font-weight: bold;\n  }\n  .operate-box {\n    padding: 10px;\n    border: 1px solid #DCDFE6;\n    /* box-shadow: 0 2px 4px 0 rgb(0 0 0 / 12%), 0 0 6px 0 rgb(0 0 0 / 4%); */\n  }\n</style>\n"]}]}